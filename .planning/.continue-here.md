---
phase: between-milestones
task: npm-package-design
total_tasks: unknown
status: planning
last_updated: 2026-02-05
---

<current_state>
v4.4 milestone complete and archived. Currently in plan mode designing an NPM package
for distributing Aether to any repo. Two explore agents completed research. No code
written yet — purely in the design phase.

The user explicitly chose Option B (NPM package) over Option A (simple install script).
They confirmed the NPM package can still allow system updates (publish new version, users
run npm update).
</current_state>

<completed_work>

## v4.4 Milestone (DONE)
- All 6 phases (27-32), 15 plans, 24/24 requirements shipped
- Milestone audit passed (24/24 requirements, 22/22 integrations, 3/3 E2E flows)
- Archived to .planning/milestones/v4.4-{ROADMAP,REQUIREMENTS,MILESTONE-AUDIT}.md
- ROADMAP.md and REQUIREMENTS.md deleted (fresh for next milestone)
- PROJECT.md evolved (all v4.4 requirements moved to Validated)
- STATE.md reset, git tagged v4.4, committed as `25e466d`

## NPM Package Research (DONE)
Two explore agents completed comprehensive research:

### Agent 1: Distributable file inventory
- 14 commands (144K) in .claude/commands/ant/
- 6 worker specs (80K) in .aether/workers/
- 3 utility scripts (24K) — aether-utils.sh + atomic-write.sh + file-lock.sh
- 1 doc file (9K) — .aether/docs/pheromones.md
- 6 JSON state schema templates (2.3K) in .aether/data/
- Total: 31 files, ~270K
- No build step needed — all markdown + shell
- init.md creates state files on first run (no pre-bootstrap needed for data/)

### Agent 2: Claude Code command discovery
- Commands discovered from .claude/commands/ in CWD (project-local) AND ~/.claude/commands/ (global)
- Both directories merged; project-local likely takes precedence
- Frontmatter format: just name + description in YAML
- Plugin system exists: plugin-name/commands/ auto-discovered at load time
- No MCP server configuration needed
- Global ~/.claude/commands/ant/ has 13 commands (missing organize.md from Phase 32)
- Symlink approach viable for updates: ~/.claude/commands/ant/ -> node_modules path

### Key design questions surfaced but NOT yet answered:
1. Package name: aether-colony? @aether/colony? queen-ant?
2. CLI command name: aether? ant? colony?
3. Distribution approach: postinstall copy vs symlink vs Claude Code plugin
4. Should commands stay namespaced as ant:* or change?
5. Where do worker specs + utils live? Global install or per-project init?
6. How to handle the "per-project .aether/" bootstrapping vs "global commands" split?
</completed_work>

<remaining_work>

## NPM Package Design (NOT STARTED)
- Finalize package architecture (global commands + per-project runtime)
- Design CLI: `aether install` (global commands), `aether init` (per-project bootstrap)
- Create package.json with bin entry
- Create CLI script (bin/aether.js or bin/aether)
- Decide: copy vs symlink for global command installation
- Decide: what goes in the npm package vs what's created per-project
- Handle updates: how npm update propagates to ~/.claude/commands/

## Implementation (NOT STARTED)
- package.json
- bin/cli.js (or similar)
- Restructure repo for npm publishing (files field or .npmignore)
- postinstall hook (if using auto-install approach)
- README.md updates with install instructions
- Test: npm pack -> npm install -g -> verify commands work in fresh repo

## New Milestone Setup (NOT STARTED)
- This work should probably be tracked as a new milestone (v5.0? v4.5?)
- /cds:new-milestone not yet run
- No REQUIREMENTS.md or ROADMAP.md exist (deleted during v4.4 archival)
</remaining_work>

<decisions_made>

- User chose Option B (NPM package) over Option A (simple install script)
- User confirmed NPM is just distribution — system stays markdown + shell
- User confirmed updates work via npm publish + npm update
- v4.4 constraint "No New Commands" updated to "Command Enrichment Over Proliferation"
- v4.4 constraint "shell utils < 300 lines" updated to "< 400 lines"
</decisions_made>

<attempted_approaches>
None yet — still in research/planning phase. No failed approaches to document.
</attempted_approaches>

<dead_ends>

| Approach | Why It Won't Work | Don't Retry Because |
|----------|-------------------|---------------------|
| Option A (simple install script) | User explicitly chose NPM package instead | User wants discoverability + update mechanism of npm |
| MCP server distribution | No MCP server config exists; commands aren't tools | Claude Code commands are markdown files, not MCP tools |

</dead_ends>

<blockers>
None — purely a design/planning task.
</blockers>

<context>
The system is functionally complete (v4.4 shipped all 24 requirements) but not
distributable. It only works inside the Aether repo itself. The goal is to make it
installable in any project via `npm install -g aether-colony` (or similar).

The key architectural split is:
1. GLOBAL (once per user): commands in ~/.claude/commands/ant/ — these are the
   skill prompts that Claude Code discovers
2. PER-PROJECT (once per repo): .aether/ directory with workers, utils, state —
   these are the runtime files the commands reference via relative paths

The NPM package needs to handle both: a CLI that installs commands globally AND
bootstraps .aether/ per-project. Updates need to propagate to both locations.

Plan mode was active in Claude Code — a plan file exists at
/Users/callumcowie/.claude/plans/cozy-bouncing-scott.md but is empty (no plan
written yet). The Plan agent was NOT yet spawned — only Explore agents ran.
</context>

<next_action>
1. Resume plan mode or start fresh
2. Spawn Plan agent with the research findings to design the NPM package architecture
3. Key decisions needed: package name, CLI name, copy vs symlink, per-project bootstrap
4. Write plan, get approval, then implement

Command: /cds:resume-work
</next_action>
