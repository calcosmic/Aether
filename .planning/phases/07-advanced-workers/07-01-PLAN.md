---
phase: 07-advanced-workers
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .aether/commands/claude/oracle.md
  - .claude/commands/ant/oracle.md
  - .aether/commands/opencode/oracle.md
  - .aether/oracle/oracle.sh
autonomous: true
requirements: [ADV-01]

must_haves:
  truths:
    - "/ant:oracle launches the research wizard and creates research.json"
    - "/ant:oracle status shows research progress"
    - "/ant:oracle stop creates the stop signal file"
    - "oracle.sh runs the RALF loop using claude CLI"
  artifacts:
    - path: ".aether/commands/claude/oracle.md"
      provides: "Oracle command definition (source of truth)"
    - path: ".claude/commands/ant/oracle.md"
      provides: "Oracle command (Claude Code copy, identical to SoT)"
    - path: ".aether/commands/opencode/oracle.md"
      provides: "Oracle command (OpenCode copy, normalize-args adapted)"
    - path: ".aether/oracle/oracle.sh"
      provides: "RALF loop shell script for tmux background execution"
  key_links:
    - from: ".aether/commands/claude/oracle.md"
      to: ".aether/oracle/research.json"
      via: "Write tool creates research.json in Step 2"
      pattern: "research\\.json"
    - from: ".aether/oracle/oracle.sh"
      to: "claude CLI"
      via: "AI_CMD variable runs claude --dangerously-skip-permissions --print"
      pattern: "claude.*--print"
---

<objective>
Verify and fix the Oracle command (/ant:oracle) across all 3 locations and verify oracle.sh works.

Purpose: Oracle is the most complex advanced worker (380 lines, RALF research loop, tmux background execution). Ensuring it works means the research agent pattern is validated.
Output: Synced oracle.md across 3 locations, verified oracle.sh
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.aether/commands/claude/oracle.md
@.claude/commands/ant/oracle.md
@.aether/commands/opencode/oracle.md
@.aether/oracle/oracle.sh
@.aether/oracle/oracle.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit and fix Oracle command source of truth</name>
  <files>.aether/commands/claude/oracle.md</files>
  <action>
  Read the oracle command source of truth at `.aether/commands/claude/oracle.md`.

  Audit for these known issues:
  1. Verify all aether-utils.sh function references are correct: `swarm-display-init`, `swarm-display-update`, `swarm-display-inline`, `activity-log`, `session-verify-fresh`, `session-clear`
  2. Check that Step 1.5 (stale session check) uses correct `session-verify-fresh` syntax (fixed in Phase 2)
  3. Check that Step 2 properly creates `.aether/oracle/` directory structure
  4. Verify the tmux launch command in Step 3 references the correct `oracle.sh` path
  5. Add defensive `mkdir -p .aether/oracle` before any file operations if missing

  Also audit `.aether/oracle/oracle.sh`:
  1. Verify it uses correct `jq` commands for reading research.json
  2. Verify the AI_CMD detection works (claude and opencode)
  3. Verify the oracle.md prompt reference is correct (line 110: `$SCRIPT_DIR/oracle.md`)
  4. Read `.aether/oracle/oracle.md` to verify the iteration prompt exists and is coherent

  If oracle.md or oracle.sh have issues, make targeted fixes. If they look correct, no changes needed -- just verify.
  </action>
  <verify>
  Read the source of truth file and confirm:
  - All aether-utils.sh function names are valid (cross-reference with known functions)
  - Path references are correct
  - oracle.sh is executable and references correct files
  </verify>
  <done>Oracle source of truth verified or fixed, oracle.sh verified</done>
</task>

<task type="auto">
  <name>Task 2: Sync Oracle to Claude Code and OpenCode</name>
  <files>.claude/commands/ant/oracle.md, .aether/commands/opencode/oracle.md</files>
  <action>
  After Task 1 verifies/fixes the source of truth:

  1. **Claude Code copy** (`.claude/commands/ant/oracle.md`): Copy the source of truth EXACTLY. Run diff to verify they match.

  2. **OpenCode copy** (`.aether/commands/opencode/oracle.md`): Verify it has the correct OpenCode adaptations:
     - Step -1 normalize-args block present
     - All `$ARGUMENTS` replaced with `$normalized_args`
     - `swarm-display-inline` NOT replaced (oracle doesn't use it in final display -- verify)
     - If the OpenCode copy is already correctly adapted, leave it. If it's drifted from the source of truth in ways beyond the normalize-args adaptation, resync.

  Run diff between all 3 copies to confirm only expected differences exist.
  </action>
  <verify>
  Run diff between SoT and Claude Code copy -- should be identical.
  Run diff between SoT and OpenCode copy -- should show ONLY normalize-args differences.
  </verify>
  <done>All 3 oracle copies in sync with only expected platform differences</done>
</task>

</tasks>

<verification>
1. All 3 oracle.md files exist and are properly synced
2. oracle.sh is executable and has correct file references
3. oracle.md iteration prompt exists at .aether/oracle/oracle.md
4. No broken function references in any copy
</verification>

<success_criteria>
- /ant:oracle command definition works (wizard flow, status, stop)
- oracle.sh RALF loop references correct files
- All 3 copies synced with expected platform differences only
</success_criteria>

<output>
After completion, create `.planning/phases/07-advanced-workers/07-01-SUMMARY.md`
</output>
