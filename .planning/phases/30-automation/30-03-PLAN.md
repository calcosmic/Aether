---
phase: 30-automation
plan: 03
type: execute
wave: 3
depends_on: ["30-02"]
files_modified:
  - .claude/commands/ant/build.md
  - .claude/commands/ant/colonize.md
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Build output uses ANSI-colored status lines with caste-specific colors via Bash tool printf/echo"
    - "Wave headers, worker spawn announcements, worker results, and progress bars are colored"
    - "Reviewer summary lines use blue color, debugger lines use red"
    - "Colonize command displays box-drawing header, step progress markers, and colored colonizer output"
    - "All colored output goes through Bash tool calls -- no ANSI codes in LLM direct text"
    - "Final build summary header uses Queen color (bold yellow)"
  artifacts:
    - path: ".claude/commands/ant/build.md"
      provides: "ANSI-colored worker status, wave headers, progress bars, reviewer/debugger output"
      contains: "\\\\e\\[32m"
    - path: ".claude/commands/ant/colonize.md"
      provides: "Visual output with box header, step progress, colonizer color coding"
      contains: "\\\\e\\[36m"
  key_links:
    - from: "build.md Step 5c display"
      to: "Bash tool"
      via: "printf with ANSI escape codes"
      pattern: "bash -c.*printf.*\\\\e\\["
    - from: "colonize.md Step 6"
      to: "Bash tool"
      via: "printf with ANSI escape codes for colonizer output"
      pattern: "bash -c.*printf.*\\\\e\\["
---

<objective>
Add ANSI-colored visual output to build and colonize commands.

Purpose: Build output gains caste-specific color coding so users can instantly distinguish which ant type produced each status line (AUTO-04). Colonize command gains visual structure with headers, progress markers, and cyan-colored colonizer output (AUTO-05).

Output: Updated build.md with colored worker status, wave headers, progress bars, and result display. Updated colonize.md with box-drawing header, step progress, and colored output.
</objective>

<execution_context>
@~/.claude/cosmic-dev-system/workflows/execute-plan.md
@~/.claude/cosmic-dev-system/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/30-automation/30-CONTEXT.md
@.planning/phases/30-automation/30-RESEARCH.md
@.planning/phases/30-automation/30-02-SUMMARY.md
@.claude/commands/ant/build.md
@.claude/commands/ant/colonize.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add ANSI-colored output to build.md (AUTO-04)</name>
  <files>.claude/commands/ant/build.md</files>
  <action>
Add ANSI color coding to build.md display sections. All colored output MUST go through Bash tool calls (printf/echo). The Queen's own markdown text between bash calls remains plain.

**Color scheme (full caste map):**

```
COLOR_QUEEN="\e[1;33m"        # Bold yellow
COLOR_COLONIZER="\e[36m"      # Cyan
COLOR_ROUTESETTER="\e[33m"    # Yellow
COLOR_BUILDER="\e[32m"        # Green
COLOR_WATCHER="\e[35m"        # Magenta
COLOR_SCOUT="\e[34m"          # Blue
COLOR_ARCHITECT="\e[37m"      # White/bright
COLOR_DEBUGGER="\e[31m"       # Red
COLOR_REVIEWER="\e[34m"       # Blue (watcher variant)
COLOR_RESET="\e[0m"           # Reset
```

Add a "Color Reference" comment block near the top of build.md (after the Instructions heading, before Step 1) so the Queen has the color map available throughout execution.

**Locations to add colored output:**

1. **Step 5c.4 Wave header** -- Replace plain text wave header:
   Current: `--- Wave {N}/{total_waves} ---`
   New: Use Bash tool:
   `bash -c 'printf "\e[1;33m--- Wave %d/%d ---\e[0m\n" {N} {total}'`

2. **Step 5c.a Worker spawn announcement** -- Replace plain text:
   Current: `Spawning {caste_emoji} {caste}-ant for: {task_description}...`
   New: Use Bash tool with caste-specific color:
   `bash -c 'printf "\e[{color_code}m%-14s\e[0m %s\n" "Spawning {caste}..." "{task_description}"'`
   Where color_code maps from the caste color scheme above.

3. **Step 5c.e Worker result** -- Replace plain text status with colored output:
   For successful completion:
   `bash -c 'printf "\e[{caste_color}m%-12s\e[0m %s ... \e[32mCOMPLETE\e[0m\n" "[{CASTE}]" "{task_description}"'`
   For error:
   `bash -c 'printf "\e[31m%-12s\e[0m %s ... \e[31mERROR\e[0m\n" "[{CASTE}]" "{task_description}"'`
   (Errors always use red regardless of caste.)

4. **Step 5c.e Progress bar** -- Color the filled portion with the last worker's caste color:
   `bash -c 'printf "\e[{color}m[%s%s]\e[0m %d/%d workers complete\n" "{filled}" "{empty}" {completed} {total}'`
   Where filled uses '#' chars and empty uses '.' chars.

5. **Step 5c.f2 Debugger result** -- Use red for debugger:
   `bash -c 'printf "\e[31m%-12s\e[0m %s\n" "[DEBUGGER]" "Fixed: {diagnosis}"'` (or "Could not fix:")

6. **Step 5c.i Reviewer result** -- Use blue for reviewer:
   `bash -c 'printf "\e[34m%-12s\e[0m Wave %d: %s (%d findings)\n" "[REVIEWER]" {N} "{summary}" {count}'`
   For each finding:
   `bash -c 'printf "  \e[34m%-8s\e[0m %s\n" "{severity}" "{description}"'`

7. **Step 7e Final summary header** -- Use bold yellow (Queen color):
   `bash -c 'printf "\n\e[1;33m+=====================================================+\e[0m\n"'`
   `bash -c 'printf "\e[1;33m|  BUILD COMPLETE                                     |\e[0m\n"'`
   `bash -c 'printf "\e[1;33m+=====================================================+\e[0m\n\n"'`

8. **Step 7e Pheromone Recommendations** (added by Plan 02) -- Use dim/italic for the suggestion text:
   `bash -c 'printf "\e[33mPheromone Recommendations:\e[0m\n"'`

IMPORTANT constraints:
- Use basic 8-color ANSI codes (30-37) only -- universally supported
- NEVER put ANSI escape codes in the Queen's direct text output (markdown text)
- Color codes go ONLY in bash -c 'printf ...' or bash -c 'echo -e ...' calls
- Keep the existing plain text output as fallback instructions ("Display:" sections remain as they are, but instruct the Queen to use Bash tool for the colored version)
- Do NOT use live spinners or animations -- Task tool is synchronous, no streaming
  </action>
  <verify>
Read the updated build.md. Confirm:
1. Color reference block exists near top of file
2. Wave headers use bold yellow via Bash tool printf
3. Worker spawn announcements use caste-specific colors
4. Worker results use caste colors for success, red for errors
5. Progress bars use colored fill
6. Debugger results use red
7. Reviewer results use blue
8. Final summary uses bold yellow (Queen color)
9. No ANSI codes appear outside of bash -c '...' commands
10. Only basic 8-color codes (30-37, with bold 1;3X) are used
  </verify>
  <done>
Build output uses ANSI-colored status lines via Bash tool. Each caste has its own color. Wave headers are bold yellow, errors are red, reviewer is blue, debugger is red. Progress bars show colored fill. All ANSI codes go through Bash tool printf, never in LLM direct text.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add visual output to colonize.md (AUTO-05)</name>
  <files>.claude/commands/ant/colonize.md</files>
  <action>
Add visual structure and colored output to colonize.md to match the build command's visual style.

**Changes to colonize.md:**

1. **Step 3 (Update State) -- Add box-drawing header:**
   After updating COLONY_STATE.json, display a colored header via Bash tool:
   ```
   bash -c 'printf "\e[1;33m+=====================================================+\e[0m\n"'
   bash -c 'printf "\e[1;33m|  AETHER COLONY :: COLONIZE                          |\e[0m\n"'
   bash -c 'printf "\e[1;33m+=====================================================+\e[0m\n\n"'
   ```
   Then display:
   ```
   bash -c 'printf "  Goal: %s\n  Mode: %s\n\n" "{goal}" "{mode}"'
   ```

2. **Step 4 (Spawn Colonizer Ants) -- Add colonizer progress for STANDARD/FULL mode:**
   Before each colonizer spawn, display progress in cyan:
   ```
   bash -c 'printf "\e[36m%-14s\e[0m %s (%d/%d)\n" "[COLONIZER]" "Analyzing {lens}..." {N} 3'
   ```
   Where lens is "Structure", "Patterns", or "Stack".

   After each colonizer returns:
   ```
   bash -c 'printf "\e[36m%-14s\e[0m %s ... \e[32mDONE\e[0m\n" "[COLONIZER]" "{lens} analysis"'
   ```

3. **Step 4-LITE (Single Colonizer) -- Add progress for LIGHTWEIGHT mode:**
   Before spawn:
   ```
   bash -c 'printf "\e[36m%-14s\e[0m %s\n" "[COLONIZER]" "Analyzing codebase (lightweight)..."'
   ```
   After return:
   ```
   bash -c 'printf "\e[36m%-14s\e[0m %s ... \e[32mDONE\e[0m\n" "[COLONIZER]" "Analysis complete"'
   ```

4. **Step 4.5 (Synthesis) -- Add synthesis visual indicator for STANDARD/FULL:**
   ```
   bash -c 'printf "\n\e[1;33m%-14s\e[0m %s\n" "[QUEEN]" "Synthesizing colonizer reports..."'
   ```
   After synthesis:
   ```
   bash -c 'printf "\e[1;33m%-14s\e[0m %s ... \e[32mDONE\e[0m\n" "[QUEEN]" "Synthesis complete"'
   ```

5. **Step 6 (Display Results) -- Add step progress checkmarks:**
   Before the existing results display, show step progress:
   ```
   bash -c 'printf "\n  \e[32m✓\e[0m Step 1: Read State\n"'
   bash -c 'printf "  \e[32m✓\e[0m Step 2: Compute Pheromones\n"'
   bash -c 'printf "  \e[32m✓\e[0m Step 2.5: Detect Complexity\n"'
   bash -c 'printf "  \e[32m✓\e[0m Step 3: Update State\n"'
   bash -c 'printf "  \e[32m✓\e[0m Step 4: Colonize (%s mode)\n" "{mode}"'
   bash -c 'printf "  \e[32m✓\e[0m Step 5: Persist Findings\n"'
   bash -c 'printf "  \e[32m✓\e[0m Step 6: Display Results\n\n"'
   ```

6. **Step 6 (Display Results) -- Color the output header:**
   Replace the plain `CODEBASE COLONIZED` text with colored version:
   ```
   bash -c 'printf "\e[36m+=====================================================+\e[0m\n"'
   bash -c 'printf "\e[36m|  CODEBASE COLONIZED                                 |\e[0m\n"'
   bash -c 'printf "\e[36m+=====================================================+\e[0m\n\n"'
   ```

IMPORTANT constraints:
- All colored output through Bash tool calls only
- Colonizer uses cyan (\e[36m)
- Queen uses bold yellow (\e[1;33m)
- Success indicators use green (\e[32m)
- Basic 8-color ANSI codes only
- Keep existing display logic (findings, pheromone suggestions, next steps) as plain text -- only add color to structural elements (headers, progress, status lines)
  </action>
  <verify>
Read the updated colonize.md. Confirm:
1. Box-drawing header exists in Step 3 with bold yellow
2. Colonizer spawn progress in Step 4 uses cyan
3. Each colonizer shows progress indicator ({N}/3 for STANDARD/FULL)
4. LIGHTWEIGHT mode shows single colonizer progress
5. Synthesis step shows Queen-colored indicator
6. Step progress checkmarks exist in Step 6
7. Result header uses cyan box-drawing
8. All ANSI codes go through Bash tool calls only
9. Existing functionality (findings display, pheromone suggestions, persistence) unchanged
  </verify>
  <done>
Colonize command displays box-drawing header, step progress with checkmarks, cyan-colored colonizer progress indicators per spawn, Queen-colored synthesis indicator, and colored result header. All visual output uses Bash tool for ANSI rendering.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. Read build.md and verify all 8 colored output locations
2. Read colonize.md and verify all 6 colored output additions
3. Confirm no ANSI escape codes appear in LLM direct text (only inside bash -c '...' blocks)
4. Confirm only basic 8-color ANSI codes are used (no 256-color or truecolor)
5. Verify caste color consistency: builder=green, watcher=magenta, colonizer=cyan, debugger=red, reviewer=blue, queen=bold yellow
6. Confirm existing build.md and colonize.md functionality is preserved (all original steps still work)
</verification>

<success_criteria>
- build.md: Wave headers, worker spawns, worker results, progress bars, debugger/reviewer output all use caste-specific ANSI colors via Bash tool
- colonize.md: Box header, step progress, colonizer progress, synthesis indicator, result header all use ANSI colors via Bash tool
- No ANSI codes in LLM direct text output
- Only basic 8-color codes used
- Color scheme consistent across both files
</success_criteria>

<output>
After completion, create `.planning/phases/30-automation/30-03-SUMMARY.md`
</output>
