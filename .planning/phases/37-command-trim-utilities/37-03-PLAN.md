---
phase: 37-command-trim-utilities
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude/commands/ant/colonize.md
autonomous: true

must_haves:
  truths:
    - "Colonize performs surface scan of codebase"
    - "Output written to .planning/CODEBASE.md"
    - "Tech stack, entry points, directories identified"
  artifacts:
    - path: ".claude/commands/ant/colonize.md"
      provides: "Single-pass codebase colonization"
      max_lines: 160
  key_links:
    - from: "colonize.md"
      to: ".planning/CODEBASE.md"
      via: "file write"
      pattern: "CODEBASE.md"
---

<objective>
Reduce colonize.md from 529 lines to ~150 lines with single-pass surface scan.

Purpose: Replace multi-colonizer spawning logic with direct codebase analysis per CONTEXT.md decisions.
Output: Lean colonize command that scans key files and outputs to .planning/CODEBASE.md.
</objective>

<execution_context>
@~/.claude/cosmic-dev-system/workflows/execute-plan.md
@~/.claude/cosmic-dev-system/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/37-command-trim-utilities/37-CONTEXT.md
@.planning/phases/37-command-trim-utilities/37-RESEARCH.md

# Source file to reduce
@.claude/commands/ant/colonize.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite colonize.md with surface scan pattern</name>
  <files>.claude/commands/ant/colonize.md</files>
  <action>
Rewrite colonize.md following this structure:

```markdown
---
name: ant:colonize
description: Analyze codebase and prepare for colony work
---

You are the **Queen**. Perform initial codebase analysis.

## Instructions

### Step 1: Validate
Read `.aether/data/COLONY_STATE.json`.
If `goal: null` -> "No colony initialized. Run /ant:init first.", stop.
If `plan.phases` not empty -> "Colony already has phases. Use /ant:continue.", stop.

### Step 2: Surface Scan

Use Glob to find key files (read up to 20 total):

**Package manifests:**
- package.json, Cargo.toml, pyproject.toml, go.mod, Gemfile, pom.xml

**Documentation:**
- README.md, README.*, docs/

**Entry points:**
- src/index.*, src/main.*, main.*, app.*, lib/index.*

**Config:**
- tsconfig.json, .eslintrc.*, jest.config.*, vite.config.*, webpack.config.*

Read found files. Extract:
- Tech stack (language, framework, key dependencies)
- Entry points (main files)
- Key directories (src/, lib/, tests/, etc.)
- File counts per top-level directory

### Step 3: Write CODEBASE.md

Create `.planning/CODEBASE.md`:

```markdown
# Codebase Overview

**Stack:** <language> + <framework>
**Entry:** <main entry points>
**Structure:**
- <dir>/ (<count> files)
- ...

**Key Dependencies:**
- <dep1>
- <dep2>
- ...

**Test Location:** <tests/ or similar>
```

Keep output under 50 lines.

### Step 4: Update State
Update COLONY_STATE.json:
- Set `state: "IDLE"` (ready for planning)

### Step 5: Confirm
Output: "Codebase analysis complete. See .planning/CODEBASE.md"
Display brief summary: stack, entry point, file count.
```

Remove:
- Multi-colonizer spawning logic (Steps 2-4.5 in original)
- Colonizer synthesis step
- Verbose ASCII output templates
- Sensitivity matrix setup
- Worker assignment logic
- Knowledge injection from global learnings (defer to future phase)
  </action>
  <verify>wc -l .claude/commands/ant/colonize.md shows <= 160 lines</verify>
  <done>colonize.md reduced to ~150 lines with single-pass surface scan</done>
</task>

<task type="auto">
  <name>Task 2: Verify colonize produces valid CODEBASE.md format</name>
  <files>.claude/commands/ant/colonize.md</files>
  <action>
Review the reduced colonize.md and ensure:

1. Glob patterns cover common project types (JS/TS, Rust, Python, Go, Ruby, Java)
2. File reading capped at 20 files (prevents context bloat)
3. CODEBASE.md output format is specified (not just "write summary")
4. State update is minimal (just IDLE state, no complex structures)

If any gaps found, fix them. Ensure command is self-contained and doesn't reference removed multi-colonizer patterns.
  </action>
  <verify>Read colonize.md, confirm Glob patterns and CODEBASE.md format specified</verify>
  <done>Colonize command has clear patterns and output format specified</done>
</task>

</tasks>

<verification>
- [ ] colonize.md <= 160 lines
- [ ] Single-pass analysis (no multi-colonizer spawning)
- [ ] Glob patterns for common project types
- [ ] File reading capped at ~20 files
- [ ] Output to .planning/CODEBASE.md
- [ ] CODEBASE.md format specified (~50 lines)
- [ ] Minimal state update (IDLE only)
- [ ] Brief confirmation output
- [ ] No sensitivity matrix or worker assignment logic
</verification>

<success_criteria>
colonize.md reduced from 529 lines to ~150 lines (~72% reduction).
Command performs surface scan and writes to CODEBASE.md without multi-colonizer complexity.
</success_criteria>

<output>
After completion, create `.planning/phases/37-command-trim-utilities/37-03-SUMMARY.md`
</output>
