---
phase: 21-command-integration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .aether/workers/architect-ant.md
  - .aether/workers/builder-ant.md
  - .aether/workers/colonizer-ant.md
  - .aether/workers/route-setter-ant.md
  - .aether/workers/scout-ant.md
  - .aether/workers/watcher-ant.md
autonomous: true

must_haves:
  truths:
    - "Every worker spec instructs the ant to run pheromone-effective via Bash tool instead of computing sensitivity * strength inline"
    - "Every worker spec preserves the sensitivity table, threshold interpretation, and combination effects unchanged"
    - "Worked examples show Bash tool invocation with pheromone-effective and the same numeric values as before"
  artifacts:
    - path: ".aether/workers/architect-ant.md"
      provides: "Pheromone math via pheromone-effective"
      contains: "aether-utils.sh pheromone-effective"
    - path: ".aether/workers/builder-ant.md"
      provides: "Pheromone math via pheromone-effective"
      contains: "aether-utils.sh pheromone-effective"
    - path: ".aether/workers/colonizer-ant.md"
      provides: "Pheromone math via pheromone-effective"
      contains: "aether-utils.sh pheromone-effective"
    - path: ".aether/workers/route-setter-ant.md"
      provides: "Pheromone math via pheromone-effective"
      contains: "aether-utils.sh pheromone-effective"
    - path: ".aether/workers/scout-ant.md"
      provides: "Pheromone math via pheromone-effective"
      contains: "aether-utils.sh pheromone-effective"
    - path: ".aether/workers/watcher-ant.md"
      provides: "Pheromone math via pheromone-effective"
      contains: "aether-utils.sh pheromone-effective"
  key_links:
    - from: ".aether/workers/*.md"
      to: ".aether/aether-utils.sh"
      via: "Bash tool invocation of pheromone-effective"
      pattern: "bash .aether/aether-utils.sh pheromone-effective"
---

<objective>
Replace inline pheromone math (`effective_signal = sensitivity * signal_strength`) in all 6 worker spec files with Bash tool calls to `aether-utils.sh pheromone-effective`. The sensitivity tables, threshold interpretation, combination effects, and all other spec content remain unchanged.

Purpose: Worker ants get deterministic signal strength computation instead of LLM-approximated multiplication. Completes INT-04.
Output: 6 updated worker spec files with Bash tool invocations in their Pheromone Math sections.
</objective>

<execution_context>
@~/.claude/cosmic-dev-system/workflows/execute-plan.md
@~/.claude/cosmic-dev-system/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-command-integration/21-RESEARCH.md
@.aether/aether-utils.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace Pheromone Math in all 6 worker specs with pheromone-effective calls</name>
  <files>
    .aether/workers/architect-ant.md
    .aether/workers/builder-ant.md
    .aether/workers/colonizer-ant.md
    .aether/workers/route-setter-ant.md
    .aether/workers/scout-ant.md
    .aether/workers/watcher-ant.md
  </files>
  <action>
All 6 worker specs have an identical "Pheromone Math" section at lines 18-44. Replace this section in each file with the same pattern, customized only for that worker's specific sensitivity values and worked example.

**Replacement for the Pheromone Math section (lines 18-44 in each file):**

Replace the formula block:
```
Calculate effective signal strength to determine action priority:

```
effective_signal = sensitivity * signal_strength
```

Where signal_strength is the pheromone's current decay value (0.0 to 1.0).
```

With:
```
To compute effective signal strength for each active pheromone, use the Bash tool:

```
bash .aether/aether-utils.sh pheromone-effective <sensitivity> <strength>
```

This returns `{"ok":true,"result":{"effective_signal":N}}`. Use the `effective_signal` value to determine action priority.

If the command fails, fall back to manual multiplication: `effective_signal = sensitivity * signal_strength`.
```

Keep the **Threshold interpretation** block UNCHANGED (">0.5 PRIORITIZE", "0.3-0.5 NOTE", "<0.3 IGNORE").

**Update worked examples** to show the Bash tool invocation while keeping the same numeric values and interpretation. Each worker has different sensitivity values and example signals -- preserve those exact values but change the computation method from inline math to a Bash call.

For example, architect-ant.md currently shows:
```
FEEDBACK: sensitivity(0.6) * strength(0.8) = 0.48  -> NOTE
FOCUS:    sensitivity(0.4) * strength(0.9) = 0.36  -> NOTE
```

Replace with:
```
Run: bash .aether/aether-utils.sh pheromone-effective 0.6 0.8
Result: {"ok":true,"result":{"effective_signal":0.48}}  -> NOTE

Run: bash .aether/aether-utils.sh pheromone-effective 0.4 0.9
Result: {"ok":true,"result":{"effective_signal":0.36}}  -> NOTE
```

Apply the same pattern to each of the 6 files, using THEIR specific sensitivity values and example signal strengths. Read each file first to get the exact values.

Keep the "Action:" interpretation paragraph after each worked example UNCHANGED.

Keep the **Combination Effects** section (after Pheromone Math) completely UNCHANGED.

Keep EVERYTHING else in each worker spec UNCHANGED -- purpose, sensitivity table, event awareness, spawning scenarios, feedback interpretation, all of it.

IMPORTANT: These specs are read by spawned subagents via the Task tool. The subagents DO have Bash tool access, so the instruction "use the Bash tool" is correct in this context.
  </action>
  <verify>
For each of the 6 worker spec files, verify:
1. "bash .aether/aether-utils.sh pheromone-effective" appears in the Pheromone Math section
2. No inline `effective_signal = sensitivity * signal_strength` formula remains
3. Threshold interpretation block is unchanged (">0.5 PRIORITIZE", "0.3-0.5 NOTE", "<0.3 IGNORE")
4. Worked example uses Bash invocation with the correct sensitivity values for that specific worker
5. Combination Effects section is unchanged
6. All other sections (Purpose, Sensitivity table, Event Awareness, Spawning, etc.) are unchanged
  </verify>
  <done>All 6 worker specs instruct ants to use `bash .aether/aether-utils.sh pheromone-effective` for signal strength computation. No inline multiplication formula remains. Sensitivity values, thresholds, combination effects, and all non-computation content preserved exactly.</done>
</task>

</tasks>

<verification>
After task completes, verify the full integration:

1. Grep all 6 worker spec files for `effective_signal = sensitivity` -- should return zero matches.
2. Grep all 6 worker spec files for `aether-utils.sh pheromone-effective` -- should return 6 matches (one per file).
3. Grep all 6 worker spec files for `PRIORITIZE` -- should return 6 matches (threshold interpretation preserved).
4. Grep all 6 worker spec files for `Combination Effects` -- should return 6 matches (section preserved).
5. Spot-check one file to ensure the sensitivity values in the worked example match the sensitivity table.
</verification>

<success_criteria>
- All 6 worker specs contain `bash .aether/aether-utils.sh pheromone-effective` in their Pheromone Math section
- No inline `effective_signal = sensitivity * signal_strength` formula remains in any worker spec
- Each worker's specific sensitivity values are used in the Bash tool invocation examples
- Threshold interpretation, combination effects, and all other spec content unchanged
- Fallback instruction included for resilience
</success_criteria>

<output>
After completion, create `.planning/phases/21-command-integration/21-02-SUMMARY.md`
</output>
