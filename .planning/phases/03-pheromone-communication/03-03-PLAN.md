---
phase: 03-pheromone-communication
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude/commands/ant/feedback.md
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Queen can emit FEEDBACK pheromone with /ant:feedback command"
    - "FEEDBACK pheromone appears in pheromones.json active_pheromones array"
    - "FEEDBACK pheromone has 6-hour half-life (decay_rate: 21600 seconds)"
    - "Command follows init.md pattern (jq + atomic-write)"
  artifacts:
    - path: ".claude/commands/ant/feedback.md"
      provides: "FEEDBACK pheromone emission command"
      contains: "jq command to append FEEDBACK pheromone to active_pheromones"
    - path: ".aether/data/pheromones.json"
      provides: "Active pheromone storage"
      contains: "active_pheromones array with FEEDBACK signals"
  key_links:
    - from: ".claude/commands/ant/feedback.md"
      to: ".aether/data/pheromones.json"
      via: "jq append to active_pheromones array"
      pattern: "\\.active_pheromones \\+="
---

<objective>
Create the /ant:feedback command that emits a FEEDBACK pheromone to guide colony behavior based on Queen's observations.

Purpose: Enable Queen to provide guidance that adjusts colony behavior through 6-hour decay signals
Output: Working /ant:feedback command that creates FEEDBACK pheromone objects in pheromones.json
</objective>

<execution_context>
@~/.claude/cosmic-dev-system/workflows/execute-plan.md
@~/.claude/cosmic-dev-system/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.claude/commands/ant/init.md
@.aether/data/pheromones.json
@.planning/phases/03-pheromone-communication/03-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create /ant:feedback command using init.md pattern</name>
  <files>.claude/commands/ant/feedback.md</files>
  <action>
    Create .claude/commands/ant/feedback.md following the exact pattern from init.md (lines 69-95):

    1. **Validate input**: Check if feedback message argument is provided
    2. **Load state**: Set PHEROMONES=".aether/data/pheromones.json"
    3. **Create FEEDBACK pheromone object** using jq:
       - id: "feedback_$(date +%s)"
       - type: "FEEDBACK"
       - strength: 0.5 (from pheromones.json default)
       - created_at: ISO-8601 timestamp
       - decay_rate: 21600 (6 hours in seconds)
       - metadata.source: "queen"
       - metadata.caste: null
       - metadata.context: the feedback message
    4. **Append to active_pheromones array** using jq
    5. **Atomic write** via .aether/utils/atomic-write.sh atomic_write_from_file
    6. **Display formatted output** showing the FEEDBACK signal was emitted

    Output format should match init.md style:
    ```
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘  ğŸœ FEEDBACK Pheromone Emitted                                â•‘
    â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
    â•‘  Message: "{feedback}"                                        â•‘
    â•‘  Type: FEEDBACK (guidance signal)                             â•‘
    â•‘  Strength: 50%                                               â•‘
    â•‘  Half-Life: 6 hours                                          â•‘
    â•‘                                                               â•‘
    â•‘  Colony Response:                                            â•‘
    â•‘  âœ“ All castes will adjust based on feedback                 â•‘
    â•‘  âœ“ Architect will record pattern for learning                â•‘
    â•‘  âœ“ Future decisions will consider guidance                    â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ```

    This is a bash/jq implementation. No Python code.
  </action>
  <verify>Run /ant:feedback "great progress on API" and verify:
    1. Command executes without errors
    2. jq command appends to active_pheromones array
    3. New pheromone object has type: "FEEDBACK", strength: 0.5, decay_rate: 21600
    4. Display output shows formatted ASCII table</verify>
  <done>FEEDBACK pheromone appears in pheromones.json with correct schema and colony adjusts behavior based on feedback</done>
</task>

</tasks>

<verification>
After completion, verify:
1. /ant:feedback command executes successfully
2. FEEDBACK pheromone object created in pheromones.json active_pheromones array
3. Pheromone has correct decay_rate: 21600 (6 hours)
4. Output formatted as ASCII table matching init.md style
5. No Python code in command (pure bash/jq)
</verification>

<success_criteria>
Queen can run `/ant:feedback "great progress on API"` and see FEEDBACK pheromone created in pheromones.json with 6-hour half-life decay rate
</success_criteria>

<output>
After completion, create `.planning/phases/03-pheromone-communication/03-03-SUMMARY.md`
</output>
