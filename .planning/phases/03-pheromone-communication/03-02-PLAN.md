---
phase: 03-pheromone-communication
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude/commands/ant/redirect.md
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Queen can emit REDIRECT pheromone with /ant:redirect command"
    - "REDIRECT pheromone appears in pheromones.json active_pheromones array"
    - "REDIRECT pheromone has 24-hour half-life (decay_rate: 86400 seconds)"
    - "Command follows init.md pattern (jq + atomic-write)"
  artifacts:
    - path: ".claude/commands/ant/redirect.md"
      provides: "REDIRECT pheromone emission command"
      contains: "jq command to append REDIRECT pheromone to active_pheromones"
    - path: ".aether/data/pheromones.json"
      provides: "Active pheromone storage"
      contains: "active_pheromones array with REDIRECT signals"
  key_links:
    - from: ".claude/commands/ant/redirect.md"
      to: ".aether/data/pheromones.json"
      via: "jq append to active_pheromones array"
      pattern: "\\.active_pheromones \\+="
---

<objective>
Create the /ant:redirect command that emits a REDIRECT pheromone to warn colony away from specific approaches.

Purpose: Enable Queen to create avoidance patterns through strong repel signals with 24-hour decay
Output: Working /ant:redirect command that creates REDIRECT pheromone objects in pheromones.json
</objective>

<execution_context>
@~/.claude/cosmic-dev-system/workflows/execute-plan.md
@~/.claude/cosmic-dev-system/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.claude/commands/ant/init.md
@.aether/data/pheromones.json
@.planning/phases/03-pheromone-communication/03-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create /ant:redirect command using init.md pattern</name>
  <files>.claude/commands/ant/redirect.md</files>
  <action>
    Create .claude/commands/ant/redirect.md following the exact pattern from init.md (lines 69-95):

    1. **Validate input**: Check if redirect pattern argument is provided
    2. **Load state**: Set PHEROMONES=".aether/data/pheromones.json"
    3. **Create REDIRECT pheromone object** using jq:
       - id: "redirect_$(date +%s)"
       - type: "REDIRECT"
       - strength: 0.9 (from pheromones.json default)
       - created_at: ISO-8601 timestamp
       - decay_rate: 86400 (24 hours in seconds)
       - metadata.source: "queen"
       - metadata.caste: null
       - metadata.context: the pattern to avoid
    4. **Append to active_pheromones array** using jq
    5. **Atomic write** via .aether/utils/atomic-write.sh atomic_write_from_file
    6. **Display formatted output** showing the REDIRECT signal was emitted

    Output format should match init.md style:
    ```
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘  ğŸœ REDIRECT Pheromone Emitted                                â•‘
    â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
    â•‘  Avoid: "{pattern}"                                           â•‘
    â•‘  Type: REDIRECT (repel signal)                                â•‘
    â•‘  Strength: 90%                                               â•‘
    â•‘  Half-Life: 24 hours                                         â•‘
    â•‘                                                               â•‘
    â•‘  Colony Response:                                            â•‘
    â•‘  âœ“ Builder will avoid {pattern}                             â•‘
    â•‘  âœ“ Route-setter will exclude from planning                   â•‘
    â•‘  âœ“ Watcher will validate against constraint                  â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ```

    This is a bash/jq implementation. No Python code.
  </action>
  <verify>Run /ant:redirect "synchronous patterns" and verify:
    1. Command executes without errors
    2. jq command appends to active_pheromones array
    3. New pheromone object has type: "REDIRECT", strength: 0.9, decay_rate: 86400
    4. Display output shows formatted ASCII table</verify>
  <done>REDIRECT pheromone appears in pheromones.json with correct schema and colony avoids redirected patterns</done>
</task>

</tasks>

<verification>
After completion, verify:
1. /ant:redirect command executes successfully
2. REDIRECT pheromone object created in pheromones.json active_pheromones array
3. Pheromone has correct decay_rate: 86400 (24 hours)
4. Output formatted as ASCII table matching init.md style
5. No Python code in command (pure bash/jq)
</verification>

<success_criteria>
Queen can run `/ant:redirect "avoid synchronous patterns"` and see REDIRECT pheromone created in pheromones.json with 24-hour half-life decay rate
</success_criteria>

<output>
After completion, create `.planning/phases/03-pheromone-communication/03-02-SUMMARY.md`
</output>
