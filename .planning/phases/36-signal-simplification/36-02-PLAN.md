---
phase: 36-signal-simplification
plan: 02
type: execute
wave: 2
depends_on: ["36-01"]
files_modified:
  - commands/ant/status.md
  - commands/ant/build.md
  - commands/ant/continue.md
  - commands/ant/pause-colony.md
  - commands/ant/resume-colony.md
autonomous: true

must_haves:
  truths:
    - "Status displays time remaining for signals (not strength bars)"
    - "Build command filters expired signals on read"
    - "Continue command filters phase_end signals when advancing phases"
    - "Pause command writes paused_at timestamp to state"
    - "Resume command extends signal TTLs by pause duration"
  artifacts:
    - path: "commands/ant/status.md"
      provides: "TTL-based signal display"
      contains: "time.*remaining|expires"
    - path: "commands/ant/build.md"
      provides: "Expired signal filtering"
      contains: "expires_at"
    - path: "commands/ant/continue.md"
      provides: "Phase-end signal cleanup"
      contains: "phase_end"
    - path: "commands/ant/pause-colony.md"
      provides: "Pause timestamp tracking"
      contains: "paused_at"
    - path: "commands/ant/resume-colony.md"
      provides: "TTL extension on resume"
      contains: "pause.*duration|extend"
  key_links:
    - from: "commands/ant/status.md"
      to: ".aether/data/COLONY_STATE.json"
      via: "signals array read with filtering"
      pattern: "expires_at.*current_time"
    - from: "commands/ant/pause-colony.md"
      to: ".aether/data/COLONY_STATE.json"
      via: "paused_at timestamp write"
      pattern: "paused_at"
---

<objective>
Update all signal-consuming commands to use TTL-based filtering instead of decay math.

Purpose: Complete the transition from exponential decay to TTL expiration
Output: All commands filter expired signals correctly, pause/resume is TTL-aware
</objective>

<execution_context>
@~/.claude/cosmic-dev-system/workflows/execute-plan.md
@~/.claude/cosmic-dev-system/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/36-signal-simplification/36-RESEARCH.md
@.planning/phases/36-signal-simplification/36-01-SUMMARY.md

Reference files:
@commands/ant/status.md
@commands/ant/build.md
@commands/ant/continue.md
@commands/ant/pause-colony.md
@commands/ant/resume-colony.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update status.md with TTL-based signal display</name>
  <files>commands/ant/status.md</files>
  <action>
Replace pheromone decay computation with TTL filtering:

**Remove Step 2 (Compute Pheromone Decay):**
- Delete the call to `bash ~/.aether/aether-utils.sh pheromone-batch`
- Delete all current_strength computation logic

**Remove Step 2.5 (Clean Expired Pheromones):**
- Delete the call to `bash ~/.aether/aether-utils.sh pheromone-cleanup`
- Filtering happens on read, no cleanup command needed

**Update ACTIVE PHEROMONES display (in Step 3):**

Old format (remove):
```
{TYPE padded to 10 chars} [{bar}] {current_strength:.2f}
  "{content}"
```

New format (use):
```
{TYPE} [{priority}] "{content}" ({time_remaining})
```

Where time_remaining is:
- "phase" if expires_at == "phase_end"
- "12m left" / "2h left" if wall-clock expiration
- "expired" if expires_at < current_time (filter these out after logging)

**Filtering logic (add before display):**
```
For each signal in signals array:
  if signal.expires_at == "phase_end":
    keep (phase-scoped, always active)
  elif signal.expires_at < current_time:
    skip (expired) -- optionally log expiration event
  else:
    keep (active, show time remaining)
```

**Remove Per-Caste Sensitivity section:**
- Delete the entire sensitivity matrix table and effective signal calculations
- Delete the "Per-Caste Sensitivity:" display block

Group signals by priority in display: high first, then normal, then low.

**Update step progress display:**
- Remove Step 2 and Step 2.5 from the progress list
- Renumber remaining steps
  </action>
  <verify>Read commands/ant/status.md and confirm:
- No calls to pheromone-batch or pheromone-cleanup
- No strength bars or current_strength references
- No sensitivity matrix or effective signal calculations
- Contains filtering logic for expires_at
- Shows priority and time remaining in display</verify>
  <done>status.md displays signals with priority and time remaining, filters expired signals on read</done>
</task>

<task type="auto">
  <name>Task 2: Update build.md and continue.md signal handling</name>
  <files>commands/ant/build.md, commands/ant/continue.md</files>
  <action>
**build.md changes:**

1. **Step 3 (Compute Active Pheromones):**
   - Remove call to `bash ~/.aether/aether-utils.sh pheromone-batch`
   - Add inline filtering: filter signals where expires_at < current_time (unless "phase_end")
   - Remove current_strength calculation
   - Remove the strength bar display format

2. **Remove sensitivity matrix and effective signals:**
   - Delete the sensitivity table (INIT/FOCUS/REDIRECT/FEEDBACK x castes)
   - Delete the "Per-Caste Effective Signals" computation
   - Delete references to effective_signal = caste_sensitivity x current_strength

3. **Update pheromone display in Step 3:**
   New format:
   ```
   ACTIVE SIGNALS:
     REDIRECT [high]: "Don't use JWT" (phase)
     FOCUS [normal]: "API layer" (45m left)
     FEEDBACK [low]: "Good coverage" (2h left)
   ```

4. **Step 5a (Phase Lead prompt):**
   - Remove CASTE SENSITIVITY TABLE from the prompt
   - Replace with simple guidance: "Check high priority signals first (constraints), then normal (focus areas)"

5. **Step 7b (Emit FEEDBACK Pheromone):**
   - Update auto-emitted pheromone schema to use new format:
   ```json
   {
     "id": "auto_<timestamp>",
     "type": "FEEDBACK",
     "content": "<summary>",
     "priority": "low",
     "created_at": "<ISO-8601>",
     "expires_at": "phase_end",
     "source": "worker:builder"
   }
   ```
   - Remove pheromone-validate call (content validation still useful, keep if simple)

6. **Step 7c (Clean Expired Pheromones):**
   - Remove call to `bash ~/.aether/aether-utils.sh pheromone-cleanup`
   - Cleanup happens via filtering on read, not explicit cleanup

**continue.md changes:**

1. **Step 4.5 (Auto-Emit Pheromones):**
   - Update auto-emitted pheromone schema (same as build.md)
   - FEEDBACK: priority "low", expires_at "phase_end", source "worker:continue"
   - REDIRECT: priority "high", expires_at "phase_end", source "worker:continue"

2. **Add phase_end signal filtering on phase advance:**
   When advancing to next phase (Step 7), filter out signals where:
   - expires_at == "phase_end"
   This clears phase-scoped signals when the phase completes.

3. **Step 5 (Clean Expired Pheromones):**
   - Remove call to `bash ~/.aether/aether-utils.sh pheromone-cleanup`

4. **Remove pheromone-batch calls if any remain.**
  </action>
  <verify>
For build.md:
- grep "pheromone-batch" should return nothing
- grep "sensitivity" should return nothing (case insensitive)
- grep "expires_at" should find matches
- grep "priority" should find matches

For continue.md:
- grep "pheromone-cleanup" should return nothing
- grep "phase_end" should find filtering logic
- Auto-emitted pheromones use new schema</verify>
  <done>build.md and continue.md use TTL filtering, no decay math, phase_end signals cleared on advance</done>
</task>

<task type="auto">
  <name>Task 3: Update pause-colony.md and resume-colony.md for TTL awareness</name>
  <files>commands/ant/pause-colony.md, commands/ant/resume-colony.md</files>
  <action>
**pause-colony.md changes:**

1. **Step 2 (Compute Pheromone Decay):**
   - Remove call to `bash ~/.aether/aether-utils.sh pheromone-batch`
   - Just read signals directly, filter expired ones

2. **Add paused_at timestamp (new Step 2.5 or in Step 4):**
   When writing HANDOFF.md, also update COLONY_STATE.json:
   ```json
   "paused_at": "<ISO-8601 UTC timestamp>"
   ```
   This tracks when the colony was paused for TTL extension on resume.

3. **Update Active Pheromones display in handoff:**
   - Remove "(strength <current>)" format
   - Use: "{TYPE} [{priority}]: {content} ({time_remaining})"

**resume-colony.md changes:**

1. **Step 2 (Compute Pheromone Decay):**
   - Remove call to `bash ~/.aether/aether-utils.sh pheromone-batch`
   - Read signals directly

2. **Add TTL extension logic (new Step 2.5):**
   After reading state, check if paused_at exists in COLONY_STATE.json:
   ```
   If paused_at is set:
     pause_duration = current_time - paused_at
     For each signal where expires_at is a timestamp (not "phase_end"):
       expires_at = expires_at + pause_duration
     Clear paused_at from COLONY_STATE.json
     Write updated state
   ```
   This ensures signals don't expire during legitimate pauses.

3. **Update ACTIVE PHEROMONES display:**
   - Remove strength bar format
   - Use priority + time remaining format

4. **Update step progress to reflect new steps.**
  </action>
  <verify>
For pause-colony.md:
- grep "pheromone-batch" should return nothing
- grep "paused_at" should find the timestamp write
- Display uses priority format not strength

For resume-colony.md:
- grep "pheromone-batch" should return nothing
- Contains pause_duration calculation and TTL extension logic
- Contains paused_at clear logic</verify>
  <done>Pause writes paused_at timestamp, resume extends signal TTLs by pause duration</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. No decay math remaining:
   - grep -r "pheromone-batch\|pheromone-cleanup\|current_strength\|half_life" commands/ant/*.md should return nothing

2. TTL filtering present:
   - grep -l "expires_at" commands/ant/{status,build,continue}.md should find all three

3. Pause-aware:
   - pause-colony.md writes paused_at
   - resume-colony.md reads paused_at and extends TTLs

4. Sensitivity matrices removed:
   - grep -i "sensitivity" commands/ant/build.md should return nothing
</verification>

<success_criteria>
- status.md shows time remaining and priority (no strength bars)
- build.md filters expired signals, no sensitivity matrices
- continue.md clears phase_end signals on phase advance
- pause-colony.md writes paused_at timestamp
- resume-colony.md extends signal TTLs by pause duration
- No calls to pheromone-batch, pheromone-cleanup, or decay math
</success_criteria>

<output>
After completion, create `.planning/phases/36-signal-simplification/36-02-SUMMARY.md`
</output>
