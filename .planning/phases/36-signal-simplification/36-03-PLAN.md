---
phase: 36-signal-simplification
plan: 03
type: execute
wave: 2
depends_on: ["36-01"]
files_modified:
  - .aether/aether-utils.sh
  - .aether/docs/pheromones.md
autonomous: true

must_haves:
  truths:
    - "pheromone-decay command removed from aether-utils.sh"
    - "pheromone-effective command removed from aether-utils.sh"
    - "pheromone-batch command removed from aether-utils.sh"
    - "pheromone-cleanup command removed from aether-utils.sh"
    - "validate-state pheromones updated for new schema"
    - "Documentation reflects TTL-based system"
  artifacts:
    - path: ".aether/aether-utils.sh"
      provides: "Simplified utility layer without decay math"
      min_lines: 280
    - path: ".aether/docs/pheromones.md"
      provides: "Updated pheromone documentation"
      contains: "expires_at|TTL|priority"
  key_links:
    - from: ".aether/aether-utils.sh"
      to: "help output"
      via: "command list"
      pattern: "pheromone-validate"
---

<objective>
Remove exponential decay math from aether-utils.sh and update pheromones.md documentation.

Purpose: Complete SIMP-03 by removing all decay code and updating docs
Output: Simplified aether-utils.sh (~50 lines removed), updated documentation
</objective>

<execution_context>
@~/.claude/cosmic-dev-system/workflows/execute-plan.md
@~/.claude/cosmic-dev-system/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/36-signal-simplification/36-RESEARCH.md
@.planning/phases/36-signal-simplification/36-01-SUMMARY.md

Reference files:
@.aether/aether-utils.sh
@.aether/docs/pheromones.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove pheromone decay commands from aether-utils.sh</name>
  <files>.aether/aether-utils.sh</files>
  <action>
**Commands to DELETE entirely (lines 44-98 approximately):**

1. `pheromone-decay` (lines ~44-57):
   - Removes exponential decay calculation
   - Uses half-life math with exp() function

2. `pheromone-effective` (lines ~58-62):
   - Removes sensitivity * strength calculation
   - No longer needed (priority replaces sensitivity math)

3. `pheromone-batch` (lines ~63-79):
   - Removes batch decay computation for all signals
   - Was called by status.md, build.md, etc.

4. `pheromone-cleanup` (lines ~80-98):
   - Removes expired signal cleanup
   - Filtering now happens on read in commands

**Keep pheromone-validate (lines ~99-109):**
This validates content length (min 20 chars). Still useful.

**Update help output (line ~38):**
Remove deleted commands from the commands list:
```json
{"ok":true,"commands":["help","version","pheromone-validate","validate-state","spawn-check","memory-compress","error-add","error-pattern-check","error-summary","activity-log","activity-log-init","activity-log-read","learning-promote","learning-inject"],...}
```

**Update validate-state pheromones (lines ~131-142):**
Update the schema validation to check for new fields:

Old required fields: id, type, content, strength, created_at
New required fields: id, type, content, priority, created_at, expires_at

Update the jq validation:
```jq
def sig: ["id","type","content","priority","created_at","expires_at"] as $req |
  [. as $s | $req[] | select($s[.] == null)] |
  if length == 0 then "pass" else "fail: signal missing \(join(","))" end;
```

**Estimated lines removed:** ~50 lines (pheromone-decay, pheromone-effective, pheromone-batch, pheromone-cleanup)
**Final file size:** ~320 lines (from 373)
  </action>
  <verify>
Run these checks:
1. `grep "pheromone-decay" .aether/aether-utils.sh` should return nothing
2. `grep "pheromone-effective" .aether/aether-utils.sh` should return nothing
3. `grep "pheromone-batch" .aether/aether-utils.sh` should return nothing
4. `grep "pheromone-cleanup" .aether/aether-utils.sh` should return nothing
5. `grep "pheromone-validate" .aether/aether-utils.sh` should find the validate command
6. `grep "expires_at" .aether/aether-utils.sh` should find it in validate-state
7. `bash .aether/aether-utils.sh help` should run without error and not list deleted commands</verify>
  <done>aether-utils.sh has no pheromone decay/effective/batch/cleanup commands, validate-state updated for new schema</done>
</task>

<task type="auto">
  <name>Task 2: Update pheromones.md documentation</name>
  <files>.aether/docs/pheromones.md</files>
  <action>
Rewrite the documentation to reflect the new TTL-based system:

**Section: How Pheromones Work**
Replace decay explanation with TTL explanation:
- Signals use expires_at timestamp instead of half-life decay
- Default expiration is "phase_end" (signal lasts until phase completes)
- Optional --ttl flag for wall-clock expiration (30m, 2h, 1d)
- Priority levels: high (REDIRECT), normal (FOCUS), low (FEEDBACK)
- Expired signals are filtered on read, no cleanup needed

**Update FOCUS, REDIRECT, FEEDBACK sections:**
For each signal type, update:
- Remove "Strength: 0.7 | Half-life: 1 hour | Decays to noise in: ~3-4 hours"
- Add "Priority: normal | Default expiration: end of phase"
- Remove sensitivity lists ("Highest sensitivity: Builder (0.9)...")
- Add "--ttl flag" examples

**Update command examples:**
```
/ant:focus "database schema"              # expires at phase end
/ant:focus "API layer" --ttl 2h           # expires in 2 hours
/ant:redirect "No JWT" --ttl 1d           # expires in 1 day
```

**Update Auto-Emitted Pheromones section:**
- Auto-emitted signals use priority and expires_at = "phase_end"
- Source field indicates origin: "worker:builder", "worker:continue", "global:inject"

**Remove Signal Combinations section's effective signal formula:**
- Delete "Effective signal formula: caste_sensitivity x current_strength"
- Delete thresholds (>0.5 PRIORITIZE, 0.3-0.5 NOTE, <0.3 IGNORE)
- Replace with: "Workers check high priority signals first, then normal, then low"

**Update Quick Reference table:**
Old:
| Signal | Command | Strength | Half-life | Use for |

New:
| Signal | Command | Priority | Default Expiration | Use for |
| FOCUS | /ant:focus "<area>" | normal | phase end | "Pay attention" |
| REDIRECT | /ant:redirect "<avoid>" | high | phase end | "Don't do this" |
| FEEDBACK | /ant:feedback "<note>" | low | phase end | "Adjust based on" |

**Remove the sensitivity matrix table entirely.**

**Add Pause-Aware TTL section:**
Explain that:
- When colony is paused, paused_at timestamp is recorded
- On resume, wall-clock TTLs are extended by pause duration
- Phase-scoped signals ("phase_end") are unaffected by pause
  </action>
  <verify>Read .aether/docs/pheromones.md and confirm:
- No references to "half-life", "decay", "strength: 0.X"
- Contains "expires_at", "priority", "TTL", "--ttl"
- No sensitivity matrix table
- Includes pause-aware TTL explanation</verify>
  <done>pheromones.md documents TTL-based system with priority levels and pause-awareness</done>
</task>

</tasks>

<verification>
After both tasks complete:

1. Utility cleanup verified:
   - `bash .aether/aether-utils.sh help | grep -c pheromone` should return 1 (only pheromone-validate)
   - `wc -l .aether/aether-utils.sh` should be around 320 lines (was 373)

2. Documentation updated:
   - `grep -c "half-life\|half_life" .aether/docs/pheromones.md` should return 0
   - `grep -c "expires_at\|TTL" .aether/docs/pheromones.md` should be > 5

3. Schema validation works:
   - `bash .aether/aether-utils.sh validate-state pheromones` should work with new schema
</verification>

<success_criteria>
- aether-utils.sh reduced by ~50 lines (pheromone math removed)
- Only pheromone-validate remains in help output
- validate-state pheromones checks for expires_at and priority
- pheromones.md fully documents TTL system
- No references to exponential decay, half-life, or strength anywhere
</success_criteria>

<output>
After completion, create `.planning/phases/36-signal-simplification/36-03-SUMMARY.md`
</output>
