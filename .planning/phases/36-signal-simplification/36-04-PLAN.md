---
phase: 36-signal-simplification
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - runtime/aether-utils.sh
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "pheromone-decay command removed from runtime/aether-utils.sh"
    - "pheromone-effective command removed from runtime/aether-utils.sh"
    - "pheromone-batch command removed from runtime/aether-utils.sh"
    - "pheromone-cleanup command removed from runtime/aether-utils.sh"
    - "help command lists only pheromone-validate (not removed commands)"
    - "validate-state pheromones checks for expires_at and priority"
  artifacts:
    - path: "runtime/aether-utils.sh"
      provides: "Simplified utility layer without decay math"
      min_lines: 280
  key_links:
    - from: "runtime/aether-utils.sh"
      to: "help output"
      via: "command list"
      pattern: "pheromone-validate"
---

<objective>
Remove exponential decay commands from runtime/aether-utils.sh to match .aether/aether-utils.sh.

Purpose: Close verification gap -- runtime/ directory was not updated when .aether/ was updated
Output: runtime/aether-utils.sh with no decay math, updated help, and TTL-based schema validation
</objective>

<execution_context>
@~/.claude/cosmic-dev-system/workflows/execute-plan.md
@~/.claude/cosmic-dev-system/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/36-signal-simplification/36-VERIFICATION.md

Reference files:
@runtime/aether-utils.sh
@.aether/aether-utils.sh (already updated -- use as reference)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove decay commands and update help in runtime/aether-utils.sh</name>
  <files>runtime/aether-utils.sh</files>
  <action>
Edit runtime/aether-utils.sh to remove the following commands entirely:

1. **pheromone-decay** (lines ~44-57):
   - Delete the entire case block that calculates exponential decay
   - Uses half-life math with exp() function

2. **pheromone-effective** (lines ~58-62):
   - Delete the entire case block that multiplies sensitivity * strength

3. **pheromone-batch** (lines ~63-79):
   - Delete the entire case block that computes batch decay for all signals

4. **pheromone-cleanup** (lines ~80-98):
   - Delete the entire case block that removes expired signals

**Keep pheromone-validate** (lines ~99-109):
This validates content length (min 20 chars). Keep it unchanged.

**Update help command** (line ~38):
Remove the deleted commands from the commands list JSON:

Old:
```
"commands":["help","version","pheromone-decay","pheromone-effective","pheromone-batch","pheromone-cleanup","pheromone-validate",...]
```

New:
```
"commands":["help","version","pheromone-validate",...]
```

**Update validate-state pheromones** (lines ~131-142):
Change the required signal fields from old schema to new schema:

Old: `["id","type","content","strength","created_at"]`
New: `["id","type","content","priority","created_at","expires_at"]`

The jq validation should check for the new fields:
```jq
def sig: ["id","type","content","priority","created_at","expires_at"] as $req |
  [. as $s | $req[] | select($s[.] == null)] |
  if length == 0 then "pass" else "fail: signal missing \(join(","))" end;
```
  </action>
  <verify>Run these checks:
1. `grep "pheromone-decay" runtime/aether-utils.sh` should return nothing
2. `grep "pheromone-effective" runtime/aether-utils.sh` should return nothing
3. `grep "pheromone-batch" runtime/aether-utils.sh` should return nothing
4. `grep "pheromone-cleanup" runtime/aether-utils.sh` should return nothing
5. `grep "pheromone-validate" runtime/aether-utils.sh` should find the validate command
6. `grep "expires_at" runtime/aether-utils.sh` should find it in validate-state
7. `grep "priority" runtime/aether-utils.sh` should find it in validate-state
8. `bash runtime/aether-utils.sh help` should run without error and list pheromone-validate but NOT pheromone-decay/effective/batch/cleanup</verify>
  <done>runtime/aether-utils.sh has no pheromone decay/effective/batch/cleanup commands, help is updated, validate-state uses new schema</done>
</task>

</tasks>

<verification>
After task completes:

1. No decay math remaining:
   - `grep -E "pheromone-(decay|effective|batch|cleanup)" runtime/aether-utils.sh` should return nothing

2. Help command updated:
   - `bash runtime/aether-utils.sh help | jq -r '.commands[]' | grep pheromone` should return only "pheromone-validate"

3. Schema validation updated:
   - `grep "expires_at" runtime/aether-utils.sh` should find matches
   - `grep "priority" runtime/aether-utils.sh` should find matches

4. File still works:
   - `bash runtime/aether-utils.sh help` exits with code 0
   - `bash runtime/aether-utils.sh version` returns version
</verification>

<success_criteria>
- runtime/aether-utils.sh reduced by ~50 lines (decay commands removed)
- Help output lists only pheromone-validate (not removed commands)
- validate-state pheromones checks for expires_at and priority
- File executes without error
</success_criteria>

<output>
After completion, create `.planning/phases/36-signal-simplification/36-04-SUMMARY.md`
</output>
