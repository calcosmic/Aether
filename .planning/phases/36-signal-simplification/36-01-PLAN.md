---
phase: 36-signal-simplification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - commands/ant/focus.md
  - commands/ant/redirect.md
  - commands/ant/feedback.md
autonomous: true

must_haves:
  truths:
    - "FOCUS signal uses expires_at timestamp instead of half_life_seconds"
    - "REDIRECT signal uses priority: high instead of strength: 0.9"
    - "FEEDBACK signal uses priority: low instead of strength: 0.5"
    - "User can specify --ttl duration when emitting signals"
    - "Default TTL is phase_end (not wall-clock based)"
  artifacts:
    - path: "commands/ant/focus.md"
      provides: "TTL-based FOCUS signal emission"
      contains: "expires_at"
    - path: "commands/ant/redirect.md"
      provides: "TTL-based REDIRECT signal emission"
      contains: "priority.*high"
    - path: "commands/ant/feedback.md"
      provides: "TTL-based FEEDBACK signal emission"
      contains: "priority.*low"
  key_links:
    - from: "commands/ant/focus.md"
      to: ".aether/data/COLONY_STATE.json"
      via: "signals array write"
      pattern: "signals.*array"
---

<objective>
Update signal emission commands (focus.md, redirect.md, feedback.md) to use the new TTL-based schema.

Purpose: Replace exponential decay with simple TTL expiration per SIMP-03 requirement
Output: Three updated command files using expires_at + priority instead of strength + half_life
</objective>

<execution_context>
@~/.claude/cosmic-dev-system/workflows/execute-plan.md
@~/.claude/cosmic-dev-system/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/36-signal-simplification/36-RESEARCH.md

Reference files:
@commands/ant/focus.md
@commands/ant/redirect.md
@commands/ant/feedback.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update focus.md with TTL-based signal schema</name>
  <files>commands/ant/focus.md</files>
  <action>
Replace the signal emission in Step 3 with the new schema:

Old schema (remove):
```json
{
  "id": "focus_<unix_timestamp>",
  "type": "FOCUS",
  "content": "<the focus area>",
  "strength": 0.7,
  "half_life_seconds": 3600,
  "created_at": "<ISO-8601 UTC timestamp>"
}
```

New schema (use):
```json
{
  "id": "focus_<unix_timestamp>",
  "type": "FOCUS",
  "content": "<the focus area>",
  "priority": "normal",
  "created_at": "<ISO-8601 UTC timestamp>",
  "expires_at": "<ISO-8601 UTC or 'phase_end'>",
  "source": "user"
}
```

Add TTL flag parsing before Step 3:
- If $ARGUMENTS contains --ttl followed by a duration:
  - Parse duration: "30m" = 30 minutes, "2h" = 2 hours, "1d" = 1 day
  - Calculate expires_at = created_at + duration
- Otherwise: set expires_at = "phase_end" (default)

Update Step 5 (Write Event) to use new format:
- Change content from "FOCUS: <content> (strength 0.7, half-life 1hr)"
- To "FOCUS: <content> (priority normal, expires <time or 'phase end'>)"

Update Step 6 (Display Result):
- Remove the strength bar display
- Remove the half-life display
- Remove the per-caste sensitivity table
- Show: "Priority: normal" and "Expires: <time remaining or 'end of phase'>"
- Simplify Next Steps section
  </action>
  <verify>Read commands/ant/focus.md and confirm:
- Contains "expires_at" in signal schema
- Contains "priority": "normal"
- Contains TTL flag parsing logic
- No references to "strength" or "half_life_seconds"
- No sensitivity matrix display</verify>
  <done>focus.md emits signals with expires_at + priority schema, supports --ttl flag, defaults to phase_end</done>
</task>

<task type="auto">
  <name>Task 2: Update redirect.md and feedback.md with TTL-based signal schema</name>
  <files>commands/ant/redirect.md, commands/ant/feedback.md</files>
  <action>
Apply the same pattern as focus.md to both files:

**redirect.md:**
- Priority: "high" (REDIRECT signals are hard constraints)
- Default expires_at: "phase_end"
- Remove strength: 0.9, half_life_seconds: 86400
- Update event content format
- Remove sensitivity table from display

**feedback.md:**
- Priority: "low" (FEEDBACK signals are observational)
- Default expires_at: "phase_end"
- Remove strength: 0.5, half_life_seconds: 21600
- Update event content format
- Remove sensitivity table from display

Both files should:
- Add TTL flag parsing (same as focus.md)
- Use source: "user"
- Simplify display output (remove strength bars, sensitivity tables)
- Show priority and expiration in display

Priority mapping per SIMP-03:
| Signal Type | Default Priority |
|-------------|------------------|
| REDIRECT    | high             |
| FOCUS       | normal           |
| FEEDBACK    | low              |
  </action>
  <verify>Read both files and confirm:
- redirect.md has priority: "high", expires_at, no strength/half_life
- feedback.md has priority: "low", expires_at, no strength/half_life
- Both have TTL flag parsing
- No sensitivity matrices in display output</verify>
  <done>All three signal commands use TTL-based schema with correct priority defaults</done>
</task>

</tasks>

<verification>
After both tasks complete:

1. Schema validation:
   - grep -E "strength|half_life" commands/ant/{focus,redirect,feedback}.md should return nothing
   - grep "expires_at" commands/ant/{focus,redirect,feedback}.md should find matches in all three

2. Priority mapping:
   - focus.md contains "priority": "normal"
   - redirect.md contains "priority": "high"
   - feedback.md contains "priority": "low"

3. TTL support:
   - All three files contain --ttl flag parsing logic
   - All three default to "phase_end"
</verification>

<success_criteria>
- All signal emission commands use new schema (expires_at, priority, source)
- No references to exponential decay (strength, half_life_seconds)
- --ttl flag supported with duration parsing (30m, 2h, 1d)
- Default expiration is "phase_end" (not wall-clock based)
- Display output simplified (no strength bars, no sensitivity tables)
</success_criteria>

<output>
After completion, create `.planning/phases/36-signal-simplification/36-01-SUMMARY.md`
</output>
