---
phase: 32-polish-safety-rails
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude/commands/ant/organize.md
autonomous: true

must_haves:
  truths:
    - "Running /ant:organize produces a structured hygiene report covering stale files, dead code patterns, and orphaned configs"
    - "The report is output-only -- no files are deleted, modified, or moved"
    - "The command reads colony data files (PROJECT_PLAN.json, errors.json, activity.log, memory.json) to ground its analysis in actual colony history"
    - "High-confidence findings are separated from speculative observations"
  artifacts:
    - path: ".claude/commands/ant/organize.md"
      provides: "Organizer/archivist ant command"
      contains: "ant:organize"
  key_links:
    - from: ".claude/commands/ant/organize.md"
      to: ".aether/data/PROJECT_PLAN.json"
      via: "Read tool to compare planned tasks vs actual files"
      pattern: "PROJECT_PLAN\\.json"
    - from: ".claude/commands/ant/organize.md"
      to: ".aether/data/errors.json"
      via: "Read tool to find recurring error patterns indicating dead code"
      pattern: "errors\\.json"
    - from: ".claude/commands/ant/organize.md"
      to: ".aether/workers/architect-ant.md"
      via: "Task tool spawns architect-ant caste for analysis"
      pattern: "architect-ant"
---

<objective>
Create the `/ant:organize` command -- a report-only codebase hygiene analyzer that spawns an architect-ant to scan for stale files, dead code patterns, and orphaned configs.

Purpose: FLOW-02 requires an organizer/archivist ant that reports codebase hygiene issues without making changes. This command follows the established pattern of reusing existing castes (Phase 30 reused watcher for reviewer, builder for debugger). The architect-ant is the natural fit -- its purpose is "synthesize knowledge, extract patterns" which maps directly to hygiene analysis.

Output: New command file `.claude/commands/ant/organize.md` invokable as `/ant:organize`.
</objective>

<execution_context>
@~/.claude/cosmic-dev-system/workflows/execute-plan.md
@~/.claude/cosmic-dev-system/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-polish-safety-rails/32-CONTEXT.md
@.aether/workers/architect-ant.md
@.claude/commands/ant/build.md
@.claude/commands/ant/status.md
@.claude/commands/ant/focus.md
@.aether/aether-utils.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create the /ant:organize command</name>
  <files>.claude/commands/ant/organize.md</files>
  <action>
Create `.claude/commands/ant/organize.md` following the established command structure (frontmatter with name/description, "You are the Queen" framing, numbered steps).

**Frontmatter:**
```yaml
---
name: ant:organize
description: Run codebase hygiene report - archivist ant scans for stale files, dead code, orphaned configs (report-only)
---
```

**Structure the command with these steps:**

### Step 1: Read State

Read these files in parallel:
- `.aether/data/COLONY_STATE.json`
- `.aether/data/PROJECT_PLAN.json`
- `.aether/data/pheromones.json`
- `.aether/data/errors.json`
- `.aether/data/memory.json`
- `.aether/data/events.json`
- `.aether/data/activity.log`

Validate: If COLONY_STATE.json has `goal: null`, output `No colony initialized. Run /ant:init first.` and stop.

### Step 2: Compute Active Pheromones

Run: `bash .aether/aether-utils.sh pheromone-batch`

Parse active pheromones (filter current_strength >= 0.05). Format as the standard ACTIVE PHEROMONES block used by other commands.

### Step 3: Spawn Archivist (Architect-Ant)

Read `.aether/workers/architect-ant.md`. Spawn via Task tool with `subagent_type="general-purpose"`:

```
--- WORKER SPEC ---
{full contents of .aether/workers/architect-ant.md}

--- ACTIVE PHEROMONES ---
{pheromone block from Step 2}

--- TASK ---
You are being spawned as an ARCHIVIST ANT (codebase hygiene analyzer).

Your mission: Produce a structured HYGIENE REPORT. You are REPORT-ONLY.
You MUST NOT delete, modify, move, or create any project files.
You may ONLY read files and produce a report.

Colony goal: "{goal from COLONY_STATE.json}"
Colony mode: {mode from COLONY_STATE.json}
Current phase: {current_phase}

--- COLONY DATA ---

PROJECT PLAN:
{full PROJECT_PLAN.json contents -- phases, tasks, their statuses}

ERROR HISTORY:
{errors.json contents -- errors array and flagged_patterns}

MEMORY:
{memory.json contents -- phase_learnings and decisions}

ACTIVITY LOG (last 50 lines):
{tail of activity.log}

--- SCAN INSTRUCTIONS ---

Analyze the codebase for hygiene issues in three categories. For each finding,
assign a confidence level: HIGH (strong evidence), MEDIUM (likely but uncertain),
or LOW (speculative). Only HIGH confidence items should be presented as actionable.

**Category 1: Stale Files**
Check for files that may no longer be needed:
- Files referenced in completed tasks that might have been scaffolding/temporary
- Look at the project structure (use Glob tool to scan key directories)
- Check for TODO/FIXME/HACK comments that reference completed phases
- Check for test fixtures or mock data that reference completed features
- Look for empty files or stub implementations

**Category 2: Dead Code Patterns**
Use colony data to identify dead code signals:
- Recurring error patterns from errors.json flagged_patterns (code that keeps breaking may be vestigial)
- Error categories with high counts concentrated in specific files
- Imports or dependencies referenced in errors but possibly no longer needed
- Read key source files and look for commented-out code blocks, unused exports, unreachable branches

**Category 3: Orphaned Configs**
Check for configuration that may not be connected:
- .aether/data/ files that have empty or default-only content
- Environment variables referenced in code but not in any .env example
- Config files that reference features/paths that don't exist
- Package.json scripts (if exists) that reference missing files

--- OUTPUT FORMAT ---

Produce your report in this exact structure:

```
CODEBASE HYGIENE REPORT
========================

Project: {goal}
Scanned: {timestamp}
Confidence threshold: HIGH findings are actionable, MEDIUM/LOW are informational

HIGH CONFIDENCE FINDINGS
-------------------------
{For each HIGH confidence finding:}
  [{category}] {description}
    Evidence: {what data/observation supports this}
    Location: {file path(s)}

{If no HIGH findings: "No high-confidence hygiene issues detected."}

MEDIUM CONFIDENCE OBSERVATIONS
-------------------------------
{For each MEDIUM confidence finding:}
  [{category}] {description}
    Evidence: {what data/observation supports this}
    Location: {file path(s)}

{If no MEDIUM findings: "No medium-confidence observations."}

LOW CONFIDENCE NOTES
---------------------
{For each LOW confidence finding:}
  [{category}] {description}

{If no LOW findings: "No low-confidence notes."}

SUMMARY
--------
  High: {count} actionable findings
  Medium: {count} observations
  Low: {count} notes

  Health: {CLEAN if 0 HIGH findings, MINOR ISSUES if 1-3 HIGH, NEEDS ATTENTION if 4+ HIGH}
```

CONSTRAINTS:
- Be CONSERVATIVE. When in doubt, classify as LOW confidence.
- Do NOT flag standard framework files (package.json, tsconfig.json, etc.) as orphaned.
- Do NOT flag .aether/ internal data files as stale (they are managed by the colony).
- Do NOT flag .claude/ command files as stale (they are the colony's brain).
- Aim for a useful report, not an exhaustive one. 5-15 findings is ideal.
```

### Step 4: Display Report

After the architect-ant returns, display:

```
+=====================================================+
|  CODEBASE HYGIENE REPORT                             |
+=====================================================+

{architect-ant's full report verbatim}
```

### Step 5: Persist Report (Optional)

Write the full report to `.aether/data/hygiene-report.md` (overwriting any previous report).

Display:
```
---
Report saved: .aether/data/hygiene-report.md

This report is advisory only. No files were modified.

Next:
  /ant:status           View colony status
  /ant:build <phase>    Continue building
  /ant:focus "<area>"   Focus colony on a hygiene area
```

### Step 6: Log Activity

Log the organize run:
```
bash .aether/aether-utils.sh activity-log "COMPLETE" "queen" "Hygiene report generated"
```

**Important design notes for the command author:**

1. The command MUST be self-contained (like all other /ant: commands). It reads state, spawns a worker, displays results.

2. Follow the exact structural conventions of existing commands -- frontmatter, "You are the Queen" intro, numbered Steps with ### headings, Read/Write/Bash tool instructions.

3. The architect-ant prompt is the bulk of the command. Be specific about what to scan and how to classify confidence. The scan instructions above are the minimum -- include them verbatim in the command.

4. The `$ARGUMENTS` variable is unused for this command (no arguments needed). But include a note that future extensions could accept a path scope argument.

5. Keep the command under 200 lines total. The tech debt report in continue.md is a good length reference.
  </action>
  <verify>
1. File exists: `.claude/commands/ant/organize.md`
2. Frontmatter contains `name: ant:organize`
3. Command reads COLONY_STATE.json and validates colony exists
4. Command reads PROJECT_PLAN.json, errors.json, memory.json, activity.log for colony data
5. Command spawns architect-ant via Task tool with report-only constraints
6. The spawn prompt includes scan instructions for all 3 categories (stale files, dead code, orphaned configs)
7. The spawn prompt includes confidence levels (HIGH/MEDIUM/LOW)
8. Report is persisted to `.aether/data/hygiene-report.md`
9. No destructive operations (no Write to project files, no delete, no rm)
10. Command follows established structure (frontmatter, numbered steps, Queen framing)
  </verify>
  <done>
/ant:organize command exists and when invoked: reads colony data, spawns an architect-ant with hygiene scan instructions, produces a structured report with confidence-tiered findings across stale files/dead code/orphaned configs, persists the report, and never modifies project files.
  </done>
</task>

</tasks>

<verification>
1. `.claude/commands/ant/organize.md` exists with correct frontmatter
2. Command structure follows established patterns (compare with focus.md, status.md)
3. Task tool prompt includes all three scan categories with specific instructions
4. Report output format includes confidence tiers
5. No destructive operations anywhere in the command
6. Activity log entry is written
</verification>

<success_criteria>
- `/ant:organize` command file exists at `.claude/commands/ant/organize.md`
- Command reads colony state and validates initialization
- Architect-ant is spawned with report-only constraints
- Scan covers stale files, dead code patterns, and orphaned configs
- Findings are classified by confidence (HIGH/MEDIUM/LOW)
- Report is displayed AND persisted to `.aether/data/hygiene-report.md`
- No project files are deleted or modified by the command
</success_criteria>

<output>
After completion, create `.planning/phases/32-polish-safety-rails/32-01-SUMMARY.md`
</output>
