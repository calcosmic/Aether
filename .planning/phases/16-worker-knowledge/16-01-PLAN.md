---
phase: 16-worker-knowledge
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .aether/workers/watcher-ant.md
autonomous: true

must_haves:
  truths:
    - "watcher-ant.md contains exactly 4 specialist modes: security, performance, quality, test-coverage"
    - "Each specialist mode has activation triggers describing when the mode activates"
    - "Each specialist mode has a severity rubric with at least 3 severity levels and examples"
    - "Each specialist mode has a detection pattern checklist with concrete items to check"
  artifacts:
    - path: ".aether/workers/watcher-ant.md"
      provides: "4 specialist watcher modes with deep domain knowledge"
      contains: "## Specialist Modes"
  key_links:
    - from: ".aether/workers/watcher-ant.md"
      to: "pheromone context"
      via: "activation triggers reference pheromone signals"
      pattern: "FOCUS|FEEDBACK|REDIRECT"
    - from: ".aether/workers/watcher-ant.md"
      to: "severity rubric"
      via: "each mode contains severity levels"
      pattern: "critical|high|medium|low"
---

<objective>
Expand watcher-ant.md with 4 specialist modes (security, performance, quality, test-coverage), each containing activation triggers, focus areas, a severity rubric, and a detection pattern checklist.

Purpose: The watcher currently has a flat Validation Checklist with 4 bullet-point areas. This plan transforms those into deep specialist modes with the domain knowledge a watcher needs to autonomously assess work without external scripts.

Output: watcher-ant.md expanded from ~104 lines to ~180+ lines with structured specialist mode sections.
</objective>

<execution_context>
@~/.claude/cosmic-dev-system/workflows/execute-plan.md
@~/.claude/cosmic-dev-system/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.aether/workers/watcher-ant.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace flat Validation Checklist with 4 deep specialist modes</name>
  <files>.aether/workers/watcher-ant.md</files>
  <action>
Read the current watcher-ant.md. Replace the existing "## Validation Checklist" section (lines 27-51, the four subsections: Security, Performance, Quality, Test Coverage) with a new "## Specialist Modes" section containing 4 mode subsections.

Each mode follows this structure:

### Mode: Security
**Activation Triggers:**
- FEEDBACK pheromone contains "security", "auth", "vulnerability", "injection"
- Task involves user input, authentication, authorization, or data exposure
- New dependencies added (check supply chain)

**Focus Areas:**
- Input validation and sanitization
- Authentication and authorization correctness
- Secret management (no hardcoded keys, proper env usage)
- Data exposure (PII in logs, error messages leaking internals)
- Dependency security (known vulnerabilities)

**Severity Rubric:**
| Severity | Criteria | Example |
|----------|----------|---------|
| CRITICAL | Exploitable vulnerability, data breach risk | SQL injection in user input, exposed API keys |
| HIGH | Security gap that needs fixing before ship | Missing auth check on protected endpoint |
| MEDIUM | Defense-in-depth issue, not immediately exploitable | Missing rate limiting on login endpoint |
| LOW | Best practice not followed, minimal risk | Console.log of non-sensitive request data |

**Detection Checklist:**
- [ ] All user inputs validated and sanitized before use
- [ ] Auth checks present on every protected route
- [ ] No secrets in source code (grep for API_KEY, SECRET, PASSWORD, TOKEN patterns)
- [ ] Error responses don't leak stack traces or internal paths
- [ ] Dependencies checked against known vulnerability databases
- [ ] CORS configured correctly (not wildcard in production)

### Mode: Performance
**Activation Triggers:**
- FEEDBACK pheromone contains "slow", "performance", "timeout", "memory"
- Task involves data processing, database queries, or rendering lists
- File changes touch hot paths (request handlers, loops, data transformations)

**Focus Areas:**
- Algorithm complexity (avoid O(n^2) where O(n) or O(n log n) suffices)
- Database query efficiency (N+1 queries, missing indexes, unnecessary joins)
- Memory management (resource cleanup, stream handling, large allocations)
- Caching opportunities (repeated computations, unchanged data)
- Bundle size impact (unnecessary imports, tree-shaking issues)

**Severity Rubric:**
| Severity | Criteria | Example |
|----------|----------|---------|
| CRITICAL | System unusable, OOM, or timeout | Unbounded data load into memory |
| HIGH | Noticeable degradation at normal scale | N+1 database queries in list endpoint |
| MEDIUM | Degradation at scale, fine for small data | O(n^2) sort on array that grows with users |
| LOW | Optimization opportunity, no current impact | Recomputing derived value that could be cached |

**Detection Checklist:**
- [ ] No nested loops over same dataset (O(n^2) signal)
- [ ] Database queries use appropriate indexes
- [ ] No N+1 query patterns (query inside a loop)
- [ ] Large data fetches are paginated or streamed
- [ ] Resources (connections, file handles) are properly closed
- [ ] No synchronous blocking operations in async contexts

### Mode: Quality
**Activation Triggers:**
- FEEDBACK pheromone contains "quality", "readability", "maintainability", "convention"
- Any code review task (default mode when no specific mode triggered)
- Task modifies shared utilities or core abstractions

**Focus Areas:**
- Code clarity and readability
- Project convention adherence (naming, file structure, patterns)
- Error handling completeness
- Type safety and contract correctness
- Separation of concerns

**Severity Rubric:**
| Severity | Criteria | Example |
|----------|----------|---------|
| CRITICAL | Code is incorrect or will break in production | Swallowed error that silently corrupts data |
| HIGH | Code works but violates core project patterns | Using callbacks where project uses async/await |
| MEDIUM | Code is unclear or fragile | Magic numbers without constants, missing edge case |
| LOW | Style or preference issue | Inconsistent naming that doesn't affect function |

**Detection Checklist:**
- [ ] Functions have single responsibility
- [ ] Error cases are handled (not swallowed or ignored)
- [ ] Naming follows project conventions
- [ ] No magic numbers or strings (use constants)
- [ ] Complex logic has explanatory comments
- [ ] No dead code or commented-out blocks

### Mode: Test Coverage
**Activation Triggers:**
- FEEDBACK pheromone contains "test", "coverage", "regression", "untested"
- Task introduces new business logic or changes existing behavior
- Bug fix without accompanying regression test

**Focus Areas:**
- Happy path coverage for new features
- Edge case identification and testing
- Error condition testing (what happens when things fail)
- Regression tests for bug fixes
- Integration test completeness for cross-boundary features

**Severity Rubric:**
| Severity | Criteria | Example |
|----------|----------|---------|
| CRITICAL | Core business logic untested | Payment calculation with no tests |
| HIGH | New feature lacks happy path test | API endpoint with no request/response test |
| MEDIUM | Edge cases not covered | Empty array, null input, boundary values untested |
| LOW | Test exists but is fragile or unclear | Test depends on execution order or external state |

**Detection Checklist:**
- [ ] Every public function has at least one test
- [ ] Happy path tested with realistic data
- [ ] Error/exception paths tested (invalid input, network failure)
- [ ] Boundary values tested (0, 1, max, empty, null)
- [ ] Bug fixes include regression test proving the fix
- [ ] Tests are independent (no shared mutable state)

IMPORTANT: Keep ALL other sections of watcher-ant.md intact (Purpose, Pheromone Sensitivity table, Workflow, Output Format, spawning section). Only replace the Validation Checklist section. The Workflow step 4 should be updated to reference specialist modes: "4. **Run validation** â€” activate relevant specialist mode(s) based on pheromone context and task type"
  </action>
  <verify>
1. Read .aether/workers/watcher-ant.md and confirm it contains "## Specialist Modes"
2. Grep for "### Mode: Security", "### Mode: Performance", "### Mode: Quality", "### Mode: Test Coverage" -- all 4 must be present
3. Grep for "Activation Triggers" -- must appear 4 times
4. Grep for "Severity Rubric" -- must appear 4 times
5. Grep for "Detection Checklist" -- must appear 4 times
6. Confirm the spawning section ("## You Can Spawn Other Ants") is still present at the end
7. Confirm file is 170+ lines (expanded from 104)
  </verify>
  <done>
watcher-ant.md contains 4 specialist modes (security, performance, quality, test-coverage), each with activation triggers referencing pheromone context, focus areas, a 4-level severity rubric with concrete examples, and a detection pattern checklist with actionable items. All original sections (Purpose, Pheromone Sensitivity, Workflow, Output Format, Spawning) remain intact.
  </done>
</task>

</tasks>

<verification>
- watcher-ant.md has exactly 4 specialist modes under "## Specialist Modes"
- Each mode has: Activation Triggers, Focus Areas, Severity Rubric (table with 4 levels), Detection Checklist
- Activation triggers reference pheromone signal types (FEEDBACK, FOCUS)
- Severity rubric uses CRITICAL/HIGH/MEDIUM/LOW with concrete examples
- Detection checklists have 5+ actionable items each
- Original file structure preserved (Purpose, Sensitivity table, Workflow, Output Format, Spawning)
</verification>

<success_criteria>
- WATCH-01: watcher-ant.md contains 4 specialist modes (security, performance, quality, test-coverage)
- WATCH-02: Mode activation triggered by pheromone context (FEEDBACK content keywords)
- WATCH-03: Each mode has severity rubric with CRITICAL/HIGH/MEDIUM/LOW levels
- WATCH-04: Each mode has detection pattern checklist with concrete items
</success_criteria>

<output>
After completion, create `.planning/phases/16-worker-knowledge/16-01-SUMMARY.md`
</output>
