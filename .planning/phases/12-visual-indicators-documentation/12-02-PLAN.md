---
phase: 12-visual-indicators-documentation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .aether/utils/atomic-write.sh
  - .aether/utils/checkpoint.sh
  - .aether/utils/state-machine.sh
  - .aether/utils/memory-ops.sh
  - .aether/utils/memory-search.sh
  - .aether/utils/memory-compress.sh
  - .aether/utils/file-lock.sh
  - .aether/utils/circuit-breaker.sh
  - .aether/utils/spawn-tracker.sh
  - .aether/utils/issue-deduper.sh
  - .aether/utils/vote-aggregator.sh
  - .aether/utils/weight-calculator.sh
  - .aether/utils/bayesian-confidence.sh
  - .aether/utils/spawn-outcome-tracker.sh
  - .aether/utils/spawn-decision.sh
  - .claude/commands/ant/adjust.md
  - .claude/commands/ant/build.md
  - .claude/commands/ant/continue.md
  - .claude/commands/ant/execute.md
  - .claude/commands/ant/feedback.md
  - .claude/commands/ant/focus.md
  - .claude/commands/ant/init.md
  - .claude/commands/ant/memory.md
  - .aether/utils/test-event-polling-integration.sh
  - .claude/commands/ant/recover.md
  - .claude/commands/ant/redirect.md
autonomous: true
user_setup: []

must_haves:
  truths:
    - "All path references in .aether/utils/ scripts are accurate and verified"
    - "All source statements use correct relative paths to utility scripts"
    - "Scripts use git root detection pattern for robustness when executed from subdirectories"
    - "Documentation comments accurately reflect actual file paths"
  artifacts:
    - path: ".aether/utils/*.sh"
      provides: "Utility scripts with verified path references"
      contains: "correct paths to .aether/data/ files and source statements"
    - path: ".claude/commands/ant/*.md"
      provides: "Command prompts with accurate path references in docstrings"
      contains: "correct paths to data files and utility scripts"
  key_links:
    - from: "utility scripts"
      to: "data files"
      via: "verified path references"
      pattern: "source .aether/utils/*.sh"
    - from: "command prompts"
      to: "utility scripts"
      via: "accurate source statements"
      pattern: "source .aether/utils/*.sh"
---

<objective>
Audit and fix all path references in utility scripts and command prompts to ensure accuracy. Verify that all source statements, data file paths, and documentation comments reference actual file locations. Use git root detection pattern for robustness.

Purpose: Eliminate "file not found" errors from incorrect path references
Output: Verified and corrected path references throughout codebase
</objective>

<execution_context>
@~/.claude/cosmic-dev-system/workflows/execute-plan.md
@~/.claude/cosmic-dev-system/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-visual-indicators-documentation/12-RESEARCH.md

# Utility scripts to audit
@.aether/utils/atomic-write.sh
@.aether/utils/checkpoint.sh
@.aether/utils/state-machine.sh
@.aether/utils/memory-ops.sh
@.aether/utils/memory-search.sh
@.aether/utils/memory-compress.sh
@.aether/utils/file-lock.sh
@.aether/utils/circuit-breaker.sh
@.aether/utils/spawn-tracker.sh
@.aether/utils/issue-deduper.sh
@.aether/utils/vote-aggregator.sh
@.aether/utils/weight-calculator.sh
@.aether/utils/bayesian-confidence.sh
@.aether/utils/spawn-outcome-tracker.sh
@.aether/utils/spawn-decision.sh

# Command prompts to audit
@.claude/commands/ant/adjust.md
@.claude/commands/ant/build.md
@.claude/commands/ant/continue.md
@.claude/commands/ant/execute.md
@.claude/commands/ant/feedback.md
@.claude/commands/ant/focus.md
@.claude/commands/ant/init.md
@.claude/commands/ant/memory.md
@.claude/commands/ant/recover.md
@.claude/commands/ant/redirect.md
</context>

<tasks>

<task type="auto">
  <name>Audit and fix path references in utility scripts</name>
  <files>.aether/utils/*.sh</files>
  <action>
    Audit all 26 utility scripts for incorrect path references and fix them:

    1. **Identify the pattern to follow:**
       The event-bus.sh script uses the git root detection pattern (RESEARCH.md line 507-511):
       ```bash
       AETHER_ROOT="$(git rev-parse --show-toplevel 2>/dev/null || echo "$PWD")"
       EVENTS_FILE="$AETHER_ROOT/.aether/data/events.json"
       ```

    2. **Audit each script for path issues:**
       For each utility script, check:
       - Hard-coded `.aether/` paths that don't use git root detection
       - Source statements (`source .aether/utils/*.sh`) with incorrect paths
       - Data file paths (`.aether/data/*.json`) that don't exist or have wrong casing
       - Comments that reference outdated paths

    3. **Fix path references using appropriate patterns:**

       **Pattern A: For scripts that source other utilities**
       Use relative path from script location (like checkpoint.sh line 12-13):
       ```bash
       _AETHER_UTILS_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
       source "$_AETHER_UTILS_DIR/atomic-write.sh"
       ```

       **Pattern B: For scripts that reference data files**
       Use git root detection for subdirectory robustness:
       ```bash
       AETHER_ROOT="$(git rev-parse --show-toplevel 2>/dev/null || echo "$PWD")"
       COLONY_STATE="$AETHER_ROOT/.aether/data/COLONY_STATE.json"
       ```

       **Pattern C: For scripts already using correct relative paths**
       Keep existing pattern if it works (e.g., `source .aether/utils/atomic-write.sh`)

    4. **Specific files to check and fix:**

       - **checkpoint.sh**: Uses `_AETHER_UTILS_DIR` pattern (correct) - verify data file paths
       - **state-machine.sh**: Check COLONY_STATE path
       - **memory-ops.sh**: Check MEMORY_FILE path
       - **memory-search.sh**: Check MEMORY_FILE path
       - **memory-compress.sh**: Check source statements
       - **atomic-write.sh**: Check TEMP_DIR, BACKUP_DIR paths
       - **file-lock.sh**: Check lock file paths
       - **circuit-breaker.sh**: Check data file references
       - **spawn-tracker.sh**: Check data file references
       - **issue-deduper.sh**: Check data file references
       - **vote-aggregator.sh**: Check data file references
       - **weight-calculator.sh**: Check data file references
       - **bayesian-confidence.sh**: Check data file references
       - **spawn-outcome-tracker.sh**: Check data file references
       - **spawn-decision.sh**: Check data file references
       - **All test scripts**: Check source statements and data paths

    5. **Verify paths exist before changing:**
       For each path referenced, verify the file exists:
       ```bash
       ls -la .aether/data/COLONY_STATE.json
       ls -la .aether/data/worker_ants.json
       ls -la .aether/data/pheromones.json
       ls -la .aether/data/memory.json
       ls -la .aether/data/events.json
       ```

    IMPORTANT:
    - Don't break working patterns - only fix incorrect paths
    - Test scripts that source from same directory can use relative paths
    - Scripts that may execute from subdirectories should use git root detection
    - Verify file casing matches actual files (case-sensitive)
    - Update comments to reflect correct paths
  </action>
  <verify>
    Run path verification checks:
    1. Source each utility script: `source .aether/utils/checkpoint.sh` - should succeed
    2. Source each utility script: `source .aether/utils/state-machine.sh` - should succeed
    3. Check that all referenced data files exist: `ls -la .aether/data/*.json`
    4. Search for broken source statements: `grep -r "source.*\.aether" .aether/utils/` - all should resolve
    5. Verify no hardcoded paths without git root detection where needed
  </verify>
  <done>
    All utility scripts have verified and correct path references
  </done>
</task>

<task type="auto">
  <name>Audit and fix path references in command prompts</name>
  <files>.claude/commands/ant/*.md</files>
  <action>
    Audit all command prompt files for incorrect path references and fix them:

    1. **Check source statements in bash code blocks:**
       For each command file, verify all `source` statements reference existing files:
       - `source .aether/utils/atomic-write.sh` ✓
       - `source .aether/utils/checkpoint.sh` ✓
       - `source .aether/utils/state-machine.sh` ✓
       - `source .aether/utils/memory-ops.sh` ✓
       - etc.

    2. **Check data file paths in code examples:**
       Verify all paths to data files are correct:
       - `.aether/data/COLONY_STATE.json` ✓
       - `.aether/data/worker_ants.json` ✓
       - `.aether/data/pheromones.json` ✓
       - `.aether/data/memory.json` ✓
       - `.aether/data/events.json` ✓

    3. **Check file casing:**
       Ensure paths match actual file names (case-sensitive):
       - COLONY_STATE.json (not colony_state.json)
       - worker_ants.json (not worker_Ants.json)
       - pheromones.json (not pheromones.JSON)

    4. **Update documentation comments:**
       Fix any comments that reference incorrect paths

    5. **Specific files to audit:**
       Use grep to find all path references:
       ```bash
       # Find all .aether path references
       grep -n "\.aether" .claude/commands/ant/*.md

       # Find all source statements
       grep -n "source" .claude/commands/ant/*.md
       ```

    6. **Common fixes needed:**
       - Change `source .aether/utils/atomic-write.sh` to use bash syntax
       - Fix `.aether/utils/atomic-write.sh atomic_write_from_file` to `.aether/utils/atomic-write.sh atomic_write_from_file` (function call pattern)
       - Update file paths to match actual casing

    IMPORTANT:
    - Command prompts contain bash/python code examples - ensure code is syntactically correct
    - Source statements in bash should use: `source .aether/utils/file.sh` or `. .aether/utils/file.sh`
    - Function calls after sourcing: `function_name args` (not repeating the source path)
    - Verify all referenced files actually exist
  </action>
  <verify>
    Run path reference verification:
    1. Search for broken source statements: `grep -n "source" .claude/commands/ant/*.md`
    2. Search for data file paths: `grep -n "\.aether/data" .claude/commands/ant/*.md`
    3. For each path found, verify the file exists: `ls -la <path>`
    4. Check that file casing matches actual files
    5. Verify bash syntax in code examples is correct
  </verify>
  <done>
    All command prompt files have accurate path references in code examples
  </done>
</task>

</tasks>

<verification>
After completing all tasks, verify:

1. Utility Script Path Test:
   - Source each utility script from repository root: all succeed
   - Source each utility script from subdirectory: all succeed (git root detection works)
   - Verify all referenced data files exist

2. Command Prompt Path Test:
   - All source statements reference existing files
   - All data file paths reference existing files
   - File casing matches actual files

3. Integration Test:
   - Run `/ant:status` - should work without path errors
   - Run `/ant:init "test"` - should work without path errors
   - Run `/ant:build 1` - should work without path errors
</verification>

<success_criteria>
1. All 26 utility scripts have verified correct path references
2. All source statements in utility scripts use appropriate pattern (relative or git root)
3. All command prompts have accurate path references
4. No "file not found" errors when running commands
5. Scripts work correctly when executed from subdirectories (git root detection)
6. Documentation comments match actual file paths
</success_criteria>

<output>
After completion, create `.planning/phases/12-visual-indicators-documentation/12-02-SUMMARY.md`
</output>
