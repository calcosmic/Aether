---
phase: 12-visual-indicators-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude/commands/ant/status.md
  - .claude/commands/ant/init.md
  - .claude/commands/ant/build.md
  - .claude/commands/ant/execute.md
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User sees Worker Ant activity states (üü¢ ACTIVE, ‚ö™ IDLE, üî¥ ERROR, ‚è≥ PENDING) in status output"
    - "User sees step progress indicators ([‚úì], [‚Üí], [ ]) during multi-step command execution"
    - "User sees pheromone signal strength as visual progress bar ([‚îÅ‚îÅ‚îÅ‚îÅ] 0.75) in status output"
    - "User sees Worker Ants grouped by activity state in visual dashboard"
    - "Emojis are paired with text labels for accessibility (e.g., 'üü¢ ACTIVE' not just 'üü¢')"
  artifacts:
    - path: ".claude/commands/ant/status.md"
      provides: "Visual dashboard with emoji status indicators and pheromone progress bars"
      contains: "get_status_emoji(), show_progress_bar(), grouped activity display"
    - path: ".claude/commands/ant/init.md"
      provides: "Step progress indicators for 7-step initialization process"
      contains: "step tracker with [‚úì]/[‚Üí]/[ ] indicators"
    - path: ".claude/commands/ant/build.md"
      provides: "Step progress indicators for phase build process"
      contains: "step tracker with [‚úì]/[‚Üí]/[ ] indicators"
    - path: ".claude/commands/ant/execute.md"
      provides: "Step progress indicators for phase execution process"
      contains: "step tracker with [‚úì]/[‚Üí]/[ ] indicators"
  key_links:
    - from: ".claude/commands/ant/status.md"
      to: ".aether/data/worker_ants.json"
      via: "jq extracts status field for emoji mapping"
      pattern: "jq -r '.worker_registry.*.status'"
    - from: ".claude/commands/ant/status.md"
      to: ".aether/data/pheromones.json"
      via: "jq extracts strength field for progress bar display"
      pattern: "jq -r '.active_pheromones.*.strength'"
    - from: "step progress trackers"
      to: "command output"
      via: "echo statements with emoji indicators"
      pattern: "echo \"  \\[‚úì\\] Step N\""
---

<objective>
Add visual indicators to Aether commands so users see colony activity at a glance. Enhance `/ant:status` with emoji-based activity states and pheromone progress bars, and add step progress indicators to multi-step commands (init, build, execute).

Purpose: Improve user experience with instant visual feedback on colony status and command progress
Output: Enhanced status dashboard and step progress displays
</objective>

<execution_context>
@~/.claude/cosmic-dev-system/workflows/execute-plan.md
@~/.claude/cosmic-dev-system/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-visual-indicators-documentation/12-RESEARCH.md
@.planning/phases/11-event-polling-integration/11-*-SUMMARY.md

# Current state files
@.aether/data/worker_ants.json
@.aether/data/pheromones.json

# Current command implementations
@.claude/commands/ant/status.md
@.claude/commands/ant/init.md
@.claude/commands/ant/build.md
@.claude/commands/ant/execute.md
</context>

<tasks>

<task type="auto">
  <name>Enhance /ant:status with visual dashboard</name>
  <files>.claude/commands/ant/status.md</files>
  <action>
    Add visual indicators to the status command following patterns from RESEARCH.md:

    1. Add status emoji mapping function (after Step 1, before Step 2):
    ```bash
    # Map status to emoji with text label for accessibility
    get_status_emoji() {
      local status=$1
      case $status in
        ACTIVE)   echo "üü¢" ;;
        IDLE|idle)     echo "‚ö™" ;;
        PENDING|pending|ready)  echo "‚è≥" ;;
        ERROR|error)    echo "üî¥" ;;
        *)        echo "‚ùì" ;;
      esac
    }
    ```

    2. Add progress bar function (after get_status_emoji):
    ```bash
    # Display pheromone strength as visual progress bar
    show_progress_bar() {
      local value=$1  # 0.0 to 1.0
      local width=${2:-20}

      # Clamp value to 0.0-1.0 range
      value=$(awk -v v="$value" 'BEGIN {print (v < 0 ? 0 : (v > 1 ? 1 : v))}')

      local filled=$(awk -v v="$value" -v w="$width" 'BEGIN {printf "%.0f", v * w}')
      local empty=$((width - filled))

      # Build bar with box-drawing character
      printf "["
      printf "‚îÅ%.0s" $(seq 1 $filled)
      printf " %.0s" $(seq 1 $empty)
      printf "] %.2f\n" "$value"
    }
    ```

    3. Update Step 4 (Display Worker Ant Status) to:
    - Group workers by activity state (ACTIVE, IDLE, ERROR, PENDING)
    - Use emoji indicators with text labels
    - Show caste and current task for ACTIVE workers
    - Add section headers: "=== ACTIVE (N) ===", "=== IDLE (N) ===", etc.

    Replace the current caste loop with:
    ```bash
    # Parse worker_ants.json and group by status
    declare -a active_workers=()
    declare -a idle_workers=()
    declare -a error_workers=()
    declare -a pending_workers=()

    jq -r '.castes | to_entries[] | "\(.key)|\(.value.status)|\(.value.name)|\(.value.current_task // "none"}"' "$WORKER_ANTS" | while IFS='|' read -r caste status name task; do
      case $status in
        active|ACTIVE)   active_workers+=("$caste|$name|$task") ;;
        idle|IDLE)       idle_workers+=("$caste|$name") ;;
        error|ERROR)     error_workers+=("$caste|$name") ;;
        pending|PENDING|ready|READY)  pending_workers+=("$caste|$name") ;;
      esac
    done

    echo "=== ACTIVE (${#active_workers[@]}) ==="
    for worker in "${active_workers[@]}"; do
      IFS='|' read -r caste name task <<< "$worker"
      echo "  üêú $name ($caste): $task"
    done

    echo ""
    echo "=== IDLE (${#idle_workers[@]}) ==="
    for worker in "${idle_workers[@]}"; do
      IFS='|' read -r caste name <<< "$worker"
      echo "  ‚ö™ $name ($caste) - IDLE"
    done

    # Display ERROR and PENDING sections similarly
    ```

    4. Update Step 5 (Display Active Pheromones) to use progress bars:
    Replace the current pheromone display with:
    ```bash
    jq -r '.active_pheromones[] | "\(.type)|\(.metadata.context)|\(.strength)"' "$PHEROMONES" | while IFS='|' read -r type context strength; do
      echo "  [$type] $context"
      echo "    Strength: $(show_progress_bar "$strength")"
    done
    ```

    IMPORTANT: Always pair emojis with text labels for accessibility (e.g., "üü¢ ACTIVE", not just "üü¢").
  </action>
  <verify>
    Run `/ant:status` and verify:
    1. Worker Ants are grouped by activity state (ACTIVE, IDLE, ERROR, PENDING)
    2. Each worker shows emoji indicator (üü¢, ‚ö™, üî¥, ‚è≥) with text label
    3. Active workers show current task
    4. Pheromones display strength as progress bar: "[‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ] 0.75"
    5. Section headers show counts: "=== ACTIVE (2) ==="
  </verify>
  <done>
    Status command displays visual dashboard with emoji indicators, activity grouping, and pheromone progress bars
  </done>
</task>

<task type="auto">
  <name>Add step progress indicators to multi-step commands</name>
  <files>.claude/commands/ant/init.md, .claude/commands/ant/build.md, .claude/commands/ant/execute.md</files>
  <action>
    Add step progress tracking to init, build, and execute commands following the pattern from RESEARCH.md:

    For each command:

    1. **init.md** (7-step initialization):
    Add after "## Step 1: Validate Preconditions" section:
    ```bash
    # Step tracking for progress display
    declare -a STEPS=("Validate Preconditions" "Receive Intention" "Initialize Colony State" "Emit INIT Pheromone" "Set Worker Ants to Ready" "Create Memory Files" "Display Success Message")
    declare -a STEP_STATUS=("completed" "pending" "pending" "pending" "pending" "pending" "pending")

    show_step_progress() {
      echo ""
      echo "üìä Initialization Progress:"
      for i in "${!STEPS[@]}"; do
        local step_num=$((i + 1))
        local step="${STEPS[$i]}"
        local status="${STEP_STATUS[$i]}"

        case $status in
          completed) echo "  [‚úì] Step $step_num/7: $step" ;;
          in_progress) echo "  [‚Üí] Step $step_num/7: $step..." ;;
          failed) echo "  [üî¥] Step $step_num/7: $step ‚Äî failed" ;;
          *) echo "  [ ] Step $step_num/7: $step" ;;
        esac
      done
      echo ""
    }

    # Mark current step as in progress
    update_step_status() {
      local step_num=$1
      local status=$2
      STEP_STATUS[$((step_num - 1))]=$status
      show_step_progress
    }
    ```

    Add at the START of each step (after the step header):
    ```bash
    update_step_status 1 "in_progress"
    ```
    Add at the END of each step (before next step header):
    ```bash
    update_step_status 1 "completed"
    ```

    2. **build.md** (5-step build process):
    Add similar step tracking with steps:
    - "Validate Input"
    - "Load Colony State"
    - "Emit Build Signal"
    - "Set Phase to In Progress"
    - "Spawn Phase Coordinator"

    3. **execute.md** (6-step execution process):
    Add similar step tracking with steps:
    - "Validate Input"
    - "Load Colony State"
    - "Emit Init Pheromone for Phase"
    - "Set Phase to In Progress"
    - "Spawn Worker Ants for Execution"
    - "Execute with Emergence"

    IMPORTANT:
    - Initialize STEPS array with ALL step names at the start
    - Initialize STEP_STATUS array with all "pending" except first step "completed"
    - Call update_step_status at the START of each step (mark as "in_progress")
    - Call update_step_status at the END of each step (mark as "completed")
    - Call show_step_progress after each status update
  </action>
  <verify>
    Test each command and verify step progress display:
    1. `/ant:init "test goal"` - shows 7 steps with [‚úì]/[‚Üí]/[ ] indicators
    2. `/ant:build 1` - shows 5 steps with progress indicators
    3. `/ant:execute 1` - shows 6 steps with progress indicators
    4. Each step updates from [ ] ‚Üí [‚Üí] ‚Üí [‚úì] as execution progresses
    5. Current step shows [‚Üí] with "..." suffix
    6. Completed steps show [‚úì] without suffix
  </verify>
  <done>
    Multi-step commands display visual progress indicators showing all steps with completion status
  </done>
</task>

</tasks>

<verification>
After completing all tasks, verify:

1. Visual Dashboard Test:
   - Run `/ant:status` on initialized colony
   - Confirm Worker Ants grouped by activity state
   - Confirm emoji indicators with text labels (üü¢ ACTIVE, ‚ö™ IDLE, etc.)
   - Confirm pheromone strength shows as progress bar

2. Step Progress Test:
   - Run `/ant:init "test goal"` and observe step progression
   - Run `/ant:build 1` and observe step progression
   - Run `/ant:execute 1` and observe step progression
   - Confirm [ ] ‚Üí [‚Üí] ‚Üí [‚úì] progression works

3. Accessibility Test:
   - Confirm all emojis paired with text labels
   - Confirm progress bars show numeric values alongside visual bars
   - Confirm section headers include counts
</verification>

<success_criteria>
1. `/ant:status` displays Worker Ants grouped by activity state with emoji indicators (üü¢ ACTIVE, ‚ö™ IDLE, üî¥ ERROR, ‚è≥ PENDING)
2. Active workers show current task in status output
3. Pheromone strength displays as visual progress bar with numeric value ([‚îÅ‚îÅ‚îÅ‚îÅ] 0.75)
4. Multi-step commands show all steps with [‚úì]/[‚Üí]/[ ] progress indicators
5. Step progression updates in real-time as commands execute
6. All visual indicators include text labels for accessibility
</success_criteria>

<output>
After completion, create `.planning/phases/12-visual-indicators-documentation/12-01-SUMMARY.md`
</output>
