---
phase: 17-integration-dashboard
plan: 03
type: execute
wave: 2
depends_on: ["17-02"]
files_modified:
  - .claude/commands/ant/init.md
  - .claude/commands/ant/build.md
  - .claude/commands/ant/continue.md
  - .aether/workers/colonizer-ant.md
  - .aether/workers/route-setter-ant.md
  - .aether/workers/builder-ant.md
  - .aether/workers/watcher-ant.md
  - .aether/workers/scout-ant.md
  - .aether/workers/architect-ant.md
autonomous: true

must_haves:
  truths:
    - "COLONY_STATE.json template in init.md includes spawn_outcomes field with alpha/beta per caste"
    - "build.md Step 6 records spawn outcomes by parsing the ant's report for caste mentions"
    - "continue.md updates spawn_outcomes on phase completion with success/failure per caste"
    - "All 6 worker specs include a spawn confidence check before spawning with the formula confidence = alpha / (alpha + beta)"
  artifacts:
    - path: ".claude/commands/ant/init.md"
      provides: "spawn_outcomes field in COLONY_STATE.json template"
      contains: "spawn_outcomes"
    - path: ".claude/commands/ant/build.md"
      provides: "Spawn outcome recording in Step 6"
      contains: "spawn_outcomes"
    - path: ".claude/commands/ant/continue.md"
      provides: "Spawn outcome update on phase completion"
      contains: "spawn_outcomes"
    - path: ".aether/workers/colonizer-ant.md"
      provides: "Spawn confidence check"
      contains: "alpha / (alpha + beta)"
    - path: ".aether/workers/builder-ant.md"
      provides: "Spawn confidence check"
      contains: "alpha / (alpha + beta)"
    - path: ".aether/workers/watcher-ant.md"
      provides: "Spawn confidence check"
      contains: "alpha / (alpha + beta)"
    - path: ".aether/workers/route-setter-ant.md"
      provides: "Spawn confidence check"
      contains: "alpha / (alpha + beta)"
    - path: ".aether/workers/scout-ant.md"
      provides: "Spawn confidence check"
      contains: "alpha / (alpha + beta)"
    - path: ".aether/workers/architect-ant.md"
      provides: "Spawn confidence check"
      contains: "alpha / (alpha + beta)"
  key_links:
    - from: ".claude/commands/ant/init.md"
      to: ".aether/data/COLONY_STATE.json"
      via: "Step 3 write template"
      pattern: "spawn_outcomes"
    - from: ".claude/commands/ant/build.md"
      to: ".aether/data/COLONY_STATE.json"
      via: "Step 6 reads and updates spawn_outcomes"
      pattern: "spawn_outcomes.*alpha"
    - from: ".aether/workers/*-ant.md"
      to: ".aether/data/COLONY_STATE.json"
      via: "reads spawn_outcomes before spawning"
      pattern: "confidence.*alpha.*beta"
---

<objective>
Add Bayesian spawn outcome tracking to COLONY_STATE.json, init.md, build.md, continue.md, and all 6 worker specs.

Purpose: The colony learns which castes perform well over time. Workers check historical spawn confidence before spawning, enabling informed autonomous decisions. Fulfills SPAWN-01, SPAWN-02, SPAWN-03, SPAWN-04.
Output: Updated init.md (schema), build.md (recording), continue.md (success/failure update), and all 6 worker specs (confidence check).
</objective>

<execution_context>
@~/.claude/cosmic-dev-system/workflows/execute-plan.md
@~/.claude/cosmic-dev-system/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-integration-dashboard/17-RESEARCH.md
@.claude/commands/ant/init.md
@.claude/commands/ant/build.md
@.claude/commands/ant/continue.md
@.aether/workers/colonizer-ant.md
@.aether/workers/builder-ant.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add spawn_outcomes to init.md and build.md</name>
  <files>.claude/commands/ant/init.md, .claude/commands/ant/build.md</files>
  <action>
**init.md -- Add spawn_outcomes to COLONY_STATE.json template:**

Read `.claude/commands/ant/init.md`. In Step 3 ("Write Colony State"), add the `spawn_outcomes` field to the COLONY_STATE.json template. Insert it after the `workers` field:

```json
  "spawn_outcomes": {
    "colonizer":    {"alpha": 1, "beta": 1, "total_spawns": 0, "successes": 0, "failures": 0},
    "route-setter": {"alpha": 1, "beta": 1, "total_spawns": 0, "successes": 0, "failures": 0},
    "builder":      {"alpha": 1, "beta": 1, "total_spawns": 0, "successes": 0, "failures": 0},
    "watcher":      {"alpha": 1, "beta": 1, "total_spawns": 0, "successes": 0, "failures": 0},
    "scout":        {"alpha": 1, "beta": 1, "total_spawns": 0, "successes": 0, "failures": 0},
    "architect":    {"alpha": 1, "beta": 1, "total_spawns": 0, "successes": 0, "failures": 0}
  }
```

Each caste starts with alpha=1, beta=1 (uniform prior, confidence=0.50). Do NOT change any other part of init.md.

**build.md -- Add spawn outcome recording to Step 6:**

Read `.claude/commands/ant/build.md`. In Step 6 ("Record Outcome"), add a new subsection AFTER the "Write Outcome Event" block (at the end of Step 6, before Step 7). Add:

```markdown
**Record Spawn Outcomes:** Read `.aether/data/COLONY_STATE.json`. Look at the ant's report to identify which castes were spawned (look for mentions of "spawned a builder", "spawned a scout", "spawned a watcher", etc. in the report, or caste names mentioned in the context of spawning).

For each caste that was spawned during the phase:
- If the phase completed successfully: increment `alpha` and `successes` for that caste in `spawn_outcomes`
- If the phase failed: increment `beta` and `failures` for that caste in `spawn_outcomes`
- Increment `total_spawns` for that caste regardless of outcome

If the report doesn't clearly identify which castes were spawned, skip spawn outcome tracking for this phase.

Use the Write tool to write the updated COLONY_STATE.json (this write can be combined with the state update already in Step 6).
```

Do NOT change any other part of build.md.
  </action>
  <verify>Read init.md and confirm spawn_outcomes field exists in the COLONY_STATE.json template with all 6 castes. Read build.md and confirm "Record Spawn Outcomes" subsection exists in Step 6.</verify>
  <done>init.md creates COLONY_STATE.json with spawn_outcomes field. build.md records spawn outcomes per caste based on the ant's report.</done>
</task>

<task type="auto">
  <name>Task 2: Add spawn outcome update to continue.md and confidence check to all worker specs</name>
  <files>.claude/commands/ant/continue.md, .aether/workers/colonizer-ant.md, .aether/workers/route-setter-ant.md, .aether/workers/builder-ant.md, .aether/workers/watcher-ant.md, .aether/workers/scout-ant.md, .aether/workers/architect-ant.md</files>
  <action>
**continue.md -- Add spawn outcome aggregation:**

Read `.claude/commands/ant/continue.md` (which will have 8 steps after Plan 17-02 runs). In Step 4 ("Extract Phase Learnings" -- renumbered from Plan 17-02), add a paragraph at the END of Step 4 (after the memory.json write), before Step 5:

```markdown
**Update Spawn Outcomes:** Read `.aether/data/COLONY_STATE.json`. Review the events in `events.json` for events of type `phase_completed` or `phase_failed` related to the current phase. If the phase completed successfully, look at events.json for spawn-related events or the build report to identify which castes contributed. For each identified caste, increment `alpha` and `successes` in `spawn_outcomes`. If the phase failed, increment `beta` and `failures` for identified castes. Increment `total_spawns` regardless. Write the updated COLONY_STATE.json.

If no castes can be identified from events, skip this step.
```

Do NOT change step numbers or any other content in continue.md.

**All 6 worker specs -- Add spawn confidence check:**

For each of the 6 worker spec files:
- `.aether/workers/colonizer-ant.md`
- `.aether/workers/route-setter-ant.md`
- `.aether/workers/builder-ant.md`
- `.aether/workers/watcher-ant.md`
- `.aether/workers/scout-ant.md`
- `.aether/workers/architect-ant.md`

Read the file. Find the "## You Can Spawn Other Ants" section. Add a subsection BEFORE the spawning scenario example (the "### Spawning Scenario" subsection) but AFTER the available castes list. Insert:

```markdown
### Spawn Confidence Check

Before spawning, read `.aether/data/COLONY_STATE.json` and check `spawn_outcomes` for the target caste:

```
confidence = alpha / (alpha + beta)
```

**Interpretation:**
- confidence >= 0.5: Spawn freely -- this caste has a positive track record
- confidence 0.3-0.5: Spawn with caution -- consider if another caste could handle the task
- confidence < 0.3: Prefer an alternative caste -- this caste has a poor track record

**Example:**
```
spawn_outcomes.scout: {alpha: 3, beta: 4}
confidence = 3 / (3 + 4) = 0.43

Scout has marginal confidence. Consider: could a colonizer handle this
research task instead? If the task specifically needs web research (scout
specialty), spawn anyway. If it's codebase exploration, use a colonizer.
```

This is advisory, not blocking. You always retain autonomy to spawn any caste based on task requirements.
```

IMPORTANT: Do NOT create a new top-level section (##). This is a subsection (###) WITHIN the existing "## You Can Spawn Other Ants" section. Place it between the castes list / spawn process instructions and the "### Spawning Scenario" subsection.

Do NOT change any other content in the worker specs.
  </action>
  <verify>Read continue.md and confirm "Update Spawn Outcomes" paragraph exists in Step 4. Read each of the 6 worker specs and confirm "### Spawn Confidence Check" subsection exists within the "## You Can Spawn Other Ants" section, containing the formula "confidence = alpha / (alpha + beta)".</verify>
  <done>continue.md updates spawn_outcomes on phase completion. All 6 worker specs include spawn confidence check with Bayesian formula, interpretation thresholds, and worked example. The check is advisory, not blocking.</done>
</task>

</tasks>

<verification>
1. Read init.md -- confirm spawn_outcomes field in COLONY_STATE.json template with all 6 castes and alpha=1, beta=1 defaults
2. Read build.md -- confirm "Record Spawn Outcomes" subsection in Step 6
3. Read continue.md -- confirm "Update Spawn Outcomes" paragraph in Step 4
4. Read all 6 worker specs -- confirm each has "### Spawn Confidence Check" within "## You Can Spawn Other Ants"
5. Confirm confidence formula (alpha / (alpha + beta)) appears in all worker specs
6. Confirm thresholds (>=0.5 go, 0.3-0.5 caution, <0.3 prefer alternative) appear in all worker specs
7. Confirm spawn confidence is described as advisory, not blocking
</verification>

<success_criteria>
- init.md creates COLONY_STATE.json with spawn_outcomes field containing all 6 castes with alpha=1, beta=1 priors
- build.md Step 6 records spawn outcomes by parsing the ant's report for caste mentions
- continue.md Step 4 updates spawn_outcomes based on phase success/failure
- All 6 worker specs have a Spawn Confidence Check subsection with Bayesian formula
- Spawn confidence is advisory, not blocking -- workers retain full autonomy
- Requirements SPAWN-01, SPAWN-02, SPAWN-03, SPAWN-04 are satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/17-integration-dashboard/17-03-SUMMARY.md`
</output>
