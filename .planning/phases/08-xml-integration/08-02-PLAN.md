---
phase: 08-xml-integration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .aether/aether-utils.sh
autonomous: true
requirements: [XML-02, XML-03]

must_haves:
  truths:
    - "wisdom-export-xml subcommand exists in aether-utils.sh"
    - "wisdom-import-xml subcommand exists in aether-utils.sh"
    - "registry-export-xml subcommand exists in aether-utils.sh"
    - "registry-import-xml subcommand exists in aether-utils.sh"
    - "Graceful degradation when xmllint/xmlstarlet not available"
  artifacts:
    - path: ".aether/aether-utils.sh"
      provides: "wisdom-export-xml, wisdom-import-xml, registry-export-xml, registry-import-xml subcommands"
  key_links:
    - from: ".aether/aether-utils.sh"
      to: ".aether/exchange/wisdom-xml.sh"
      via: "source command loads wisdom exchange functions"
      pattern: "source.*wisdom-xml\\.sh"
    - from: ".aether/aether-utils.sh"
      to: ".aether/exchange/registry-xml.sh"
      via: "source command loads registry exchange functions"
      pattern: "source.*registry-xml\\.sh"
---

<objective>
Add wisdom and registry XML exchange subcommands to aether-utils.sh that wire in the existing wisdom-xml.sh and registry-xml.sh exchange scripts.

Purpose: Wisdom and registry XML exchange scripts exist but are not called anywhere. This plan adds subcommands for both, following the same pattern as the pheromone XML subcommands.
Output: Working wisdom and registry XML export/import subcommands
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-xml-integration/08-CONTEXT.md
@.aether/exchange/wisdom-xml.sh
@.aether/exchange/registry-xml.sh
@.aether/utils/xml-core.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add wisdom XML subcommands to aether-utils.sh</name>
  <files>.aether/aether-utils.sh</files>
  <action>
  Add 2 wisdom XML subcommands to aether-utils.sh, after the pheromone XML subcommands (or after pheromone-expire if plan 01 hasn't run yet).

  **1. wisdom-export-xml subcommand:**
  ```
  wisdom-export-xml)
    # Usage: wisdom-export-xml [input_json] [output_xml]
    # Exports queen wisdom JSON to XML format
    # Default input: .aether/data/queen-wisdom.json (or QUEEN.md equivalent)
    # Default output: .aether/exchange/queen-wisdom.xml
  ```
  Implementation:
  - Source `.aether/exchange/wisdom-xml.sh`
  - Check xmllint availability (same graceful degradation pattern)
  - Look for wisdom data: check `.aether/data/queen-wisdom.json` first, then try to extract from COLONY_STATE.json memory field
  - If no wisdom data found, create a minimal skeleton JSON with empty philosophies/patterns arrays
  - Call `xml-wisdom-export "$wisdom_json" "$output_file"`
  - Ensure output directory exists: `mkdir -p "$(dirname "$output_file")"`
  - Return JSON result

  **2. wisdom-import-xml subcommand:**
  ```
  wisdom-import-xml)
    # Usage: wisdom-import-xml <xml_file> [output_json]
    # Imports wisdom from XML into JSON format
  ```
  Implementation:
  - Source `.aether/exchange/wisdom-xml.sh`
  - Require xml_file argument
  - Call `xml-wisdom-import "$xml_file" "$output_json"`
  - Default output: `.aether/data/queen-wisdom.json`
  - Return JSON result
  </action>
  <verify>
  Verify wisdom subcommands are in the case statement and follow the established pattern.
  </verify>
  <done>Wisdom XML subcommands added to aether-utils.sh</done>
</task>

<task type="auto">
  <name>Task 2: Add registry XML subcommands to aether-utils.sh</name>
  <files>.aether/aether-utils.sh</files>
  <action>
  Add 2 registry XML subcommands to aether-utils.sh, after the wisdom XML subcommands.

  **1. registry-export-xml subcommand:**
  ```
  registry-export-xml)
    # Usage: registry-export-xml [input_json] [output_xml]
    # Exports colony registry JSON to XML format
    # Default input: .aether/data/colony-registry.json
    # Default output: .aether/exchange/colony-registry.xml
  ```
  Implementation:
  - Source `.aether/exchange/registry-xml.sh`
  - Check xmllint availability
  - Look for registry data at `.aether/data/colony-registry.json`
  - If no registry file exists, generate one on-demand from `.aether/chambers/` directory:
    - Scan chambers for manifest.json files
    - Build a registry JSON with colony entries from each chamber
    - Write to `.aether/data/colony-registry.json`
  - Call `xml-registry-export "$registry_json" "$output_file"`
  - Return JSON result

  **2. registry-import-xml subcommand:**
  ```
  registry-import-xml)
    # Usage: registry-import-xml <xml_file> [output_json]
    # Imports colony registry from XML into JSON format
  ```
  Implementation:
  - Source `.aether/exchange/registry-xml.sh`
  - Require xml_file argument
  - Call `xml-registry-import "$xml_file" "$output_json"`
  - Default output: `.aether/data/colony-registry.json`
  - Return JSON result
  </action>
  <verify>
  Verify registry subcommands are in the case statement and follow the established pattern.
  </verify>
  <done>Registry XML subcommands added to aether-utils.sh</done>
</task>

</tasks>

<verification>
1. wisdom-export-xml and wisdom-import-xml subcommands exist
2. registry-export-xml and registry-import-xml subcommands exist
3. All subcommands source the correct exchange scripts
4. Graceful degradation for missing tools
5. Default file paths are sensible
</verification>

<success_criteria>
- 4 new subcommands in aether-utils.sh (2 wisdom + 2 registry)
- Exchange scripts properly sourced and called
- Registry can be generated from chamber data if no registry file exists
- Graceful degradation for missing XML tools
</success_criteria>

<output>
After completion, create `.planning/phases/08-xml-integration/08-02-SUMMARY.md`
</output>
