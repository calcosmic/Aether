---
phase: 08-xml-integration
plan: 03
type: execute
wave: 2
depends_on: [1, 2]
files_modified:
  - .aether/commands/claude/entomb.md
  - .claude/commands/ant/entomb.md
  - .aether/commands/opencode/entomb.md
autonomous: true
requirements: [XML-01, XML-02, XML-03]

must_haves:
  truths:
    - "/ant:entomb exports pheromones as XML in the archive (opt-in)"
    - "/ant:entomb exports wisdom as XML in the archive (opt-in)"
    - "/ant:entomb generates registry entry for the archived colony"
    - "XML export failures do not block entombment (graceful degradation)"
  artifacts:
    - path: ".aether/commands/claude/entomb.md"
      provides: "Entomb command with XML archive integration"
    - path: ".claude/commands/ant/entomb.md"
      provides: "Entomb command (Claude Code copy)"
    - path: ".aether/commands/opencode/entomb.md"
      provides: "Entomb command (OpenCode copy)"
  key_links:
    - from: ".aether/commands/claude/entomb.md"
      to: ".aether/aether-utils.sh"
      via: "pheromone-export-xml and wisdom-export-xml subcommands"
      pattern: "pheromone-export-xml|wisdom-export-xml"
---

<objective>
Wire XML export into the /ant:entomb command so that colony archives include XML-formatted pheromones, wisdom, and registry data alongside the existing JSON files.

Purpose: The archive becomes the natural integration point for XML. When a colony is entombed, its signals and wisdom are preserved in both JSON (for the live system) and XML (for cross-colony exchange and data portability).
Output: Entomb command with optional XML archive exports
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-xml-integration/08-CONTEXT.md
@.aether/commands/claude/entomb.md
@.claude/commands/ant/entomb.md
@.aether/commands/opencode/entomb.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add XML archive step to entomb SoT</name>
  <files>.aether/commands/claude/entomb.md</files>
  <action>
  Read the current entomb.md source of truth and add a new step after the existing archive steps (Step 7: Archive Additional Files) that exports XML.

  **Add Step 7.5: Export XML Archives (optional)**

  After archiving JSON data files, add:

  ```markdown
  ### Step 7.5: Export XML Archives (Optional)

  Attempt to export colony data in XML format for cross-colony exchange. XML export is best-effort — failures here MUST NOT block entombment.

  ```bash
  # Export pheromones as XML (best-effort)
  if bash .aether/aether-utils.sh pheromone-export-xml "$CHAMBER_DIR/pheromones.xml" 2>/dev/null; then
    echo "Exported pheromones.xml"
  fi

  # Export wisdom as XML (best-effort)
  if bash .aether/aether-utils.sh wisdom-export-xml "" "$CHAMBER_DIR/queen-wisdom.xml" 2>/dev/null; then
    echo "Exported queen-wisdom.xml"
  fi

  # Update colony registry with this entombment
  bash .aether/aether-utils.sh registry-export-xml "" "$CHAMBER_DIR/colony-registry.xml" 2>/dev/null || true
  ```

  Key principles:
  - All XML exports wrapped in `if` or `|| true` — never block entombment
  - XML files go into the chamber directory alongside JSON files
  - No user confirmation needed — this is automatic and silent
  - If xmllint is not available, these commands silently fail (the subcommands handle graceful degradation)

  Also update the manifest section (if present) to note XML files in the archive:
  - Add `"xml_exported": true/false` to the manifest.json fields
  </action>
  <verify>
  1. Step 7.5 exists after Step 7
  2. All XML exports use || true or if-guard pattern
  3. Chamber directory path is correctly referenced
  4. Manifest updated to track XML presence
  </verify>
  <done>XML archive step added to entomb source of truth</done>
</task>

<task type="auto">
  <name>Task 2: Sync entomb to Claude Code and OpenCode copies</name>
  <files>.claude/commands/ant/entomb.md, .aether/commands/opencode/entomb.md</files>
  <action>
  After updating the source of truth:

  1. **Claude Code copy** (`.claude/commands/ant/entomb.md`): Replace with exact copy of source of truth

  2. **OpenCode copy** (`.aether/commands/opencode/entomb.md`): Replace with source of truth content, then apply the standard OpenCode adaptations:
     - Step -1 normalize-args block (should already be present)
     - $ARGUMENTS -> $normalized_args (should already be present)
     - Verify any display function differences

  Run diff to verify all 3 copies have only expected differences.
  </action>
  <verify>
  diff SoT vs Claude Code = identical.
  diff SoT vs OpenCode = only normalize-args differences.
  </verify>
  <done>Entomb synced across all 3 locations with XML archive step</done>
</task>

</tasks>

<verification>
1. Entomb SoT has Step 7.5 for XML archive exports
2. XML exports use graceful degradation (never block entombment)
3. Claude Code copy matches SoT exactly
4. OpenCode copy has correct adaptations
5. Manifest tracks XML export status
</verification>

<success_criteria>
- /ant:entomb automatically exports XML archives alongside JSON
- XML export failures never block the entombment process
- All 3 entomb copies synced with XML step
- Colony archives contain pheromones.xml and queen-wisdom.xml when xmllint available
</success_criteria>

<output>
After completion, create `.planning/phases/08-xml-integration/08-03-SUMMARY.md`
</output>
