---
phase: 02-core-infrastructure
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .aether/aether-utils.sh
autonomous: true
requirements:
  - CMD-02
  - CMD-04
  - ERR-03

must_haves:
  truths:
    - "/ant:init handles empty arguments gracefully"
    - "/ant:plan can clear sessions with --command flag"
    - "Error messages include suggestions for how to fix"
  artifacts:
    - path: ".aether/aether-utils.sh"
      provides: "session-clear and context-update functions"
      contains: "--command"
  key_links:
    - from: "session-clear"
      to: "session-verify-fresh"
      via: "code pattern"
      pattern: "case.*--command"
---

<objective>
Fix argument parsing in session-clear and context-update functions.

Purpose: session-clear is used by /ant:plan (CMD-04) but doesn't properly parse --command flag. context-update is used by /ant:init (CMD-02) but doesn't handle empty arguments gracefully. Both need proper error messages per ERR-03.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-infrastructure/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Fix session-clear to parse --command flag</name>
  <files>.aether/aether-utils.sh</files>
  <action>
1. Read lines 3572-3620 of .aether/aether-utils.sh to find session-clear function
2. Current code uses positional args: preserve="${2:-false}"
3. Replace with getopt-style parsing (while loop with case statement)
4. Parse --command flag to extract command name
5. Parse --dry-run flag for preview mode
6. Add validation: if command_name is empty, show user-friendly error with suggestion

Reference session-verify-fresh (lines 3474-3503) which correctly parses --command.
  </action>
  <verify>
grep -n "while.*command_name" .aether/aether-utils.sh
grep -n "case.*--command" .aether/aether-utils.sh
  </verify>
  <done>session-clear accepts --command <name> and --dry-run flags</done>
</task>

<task type="auto">
  <name>Fix context-update to handle empty arguments</name>
  <files>.aether/aether-utils.sh</files>
  <action>
1. Read lines 1824-1900 of .aether/aether-utils.sh to find context-update function
2. Find where ctx_action is used without validation
3. Add early validation: if ctx_action is empty, show usage message
4. Add validation for each action: init, update, get, set
5. For invalid action: json_err with message like "Unknown context action: $ctx_action. Use: init, update, get, or set"

User-friendly error format: "Error: [what went wrong]. Suggestion: [how to fix]"
  </action>
  <verify>
grep -n "ctx_action.*empty\|-z.*ctx_action" .aether/aether-utils.sh
  </verify>
  <done>context-update shows helpful error when called with no arguments or invalid action</done>
</task>

</tasks>

<verification>
Run: bash .aether/aether-utils.sh session-clear
Run: bash .aether/aether-utils.sh context-update
Verify user-friendly error messages with suggestions.
</verification>

<success_criteria>
1. session-clear --command survey works without errors
2. context-update with no args shows usage message
3. Invalid context-update action shows error with valid options listed
4. All error messages include suggestion for how to fix
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-infrastructure/02-02-SUMMARY.md`
</output>
