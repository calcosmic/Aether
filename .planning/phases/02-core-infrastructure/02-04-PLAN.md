---
phase: 02-core-infrastructure
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - .aether/aether-utils.sh
autonomous: true
requirements:
  - CMD-05
  - CMD-08
  - ERR-03

must_haves:
  truths:
    - "/ant:build can spawn swarm workers without syntax errors"
    - "spawn-can-spawn-swarm returns valid JSON"
    - "Error messages are clear when swarm limit reached"
  artifacts:
    - path: ".aether/aether-utils.sh"
      provides: "spawn-can-spawn-swarm function"
      contains: "json_ok.*can_spawn"
  key_links:
    - from: "spawn-can-spawn-swarm"
      to: "spawn-can-spawn"
      via: "code pattern"
      pattern: "local.*files.*="
---

<objective>
Fix syntax error in spawn-can-spawn-swarm function.

Purpose: Required for /ant:build (CMD-05) to execute phases with worker spawning. Currently there's a syntax error where an array is used where a string is expected (or vice versa).
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-infrastructure/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Fix spawn-can-spawn-swarm syntax error</name>
  <files>.aether/aether-utils.sh</files>
  <action>
1. Read lines 1529-1580 of .aether/aether-utils.sh to find spawn-can-spawn-swarm function
2. Look for variable that is assigned as array but used as string:
   - Common issue: local files=() then files="$some_string"
3. Compare with spawn-can-spawn (line ~1537) to see correct pattern
4. Fix by ensuring consistent type usage (string vs array)

The function should return JSON like: {"can_spawn":true,"reason":"ok"} or {"can_spawn":false,"reason":"swarm_limit_reached"}
  </action>
  <verify>
bash -n .aether/aether-utils.sh && echo "Syntax OK"
grep -n "spawn-can-spawn-swarm" .aether/aether-utils.sh | head -5
  </verify>
  <done>spawn-can-spawn-swarm runs without bash syntax errors</done>
</task>

<task type="auto">
  <name>Test spawn-can-spawn-swarm output</name>
  <files>.aether/aether-utils.sh</files>
  <action>
1. Run: bash .aether/aether-utils.sh spawn-can-spawn-swarm test-swarm-1
2. Verify output is valid JSON
3. Test when swarm already exists to verify false response
4. Test edge cases: no argument, invalid argument
  </action>
  <verify>
echo '{"can_spawn":true}' | jq empty && echo "Valid JSON"
  </verify>
  <done>spawn-can-spawn-swarm returns valid JSON with can_spawn boolean</done>
</task>

</tasks>

<verification>
Run: bash .aether/aether-utils.sh spawn-can-spawn-swarm test-swarm
Verify output is valid JSON with can_spawn field.
</verification>

<success_criteria>
1. spawn-can-spawn-swarm has no bash syntax errors
2. Returns valid JSON like {"can_spawn":true,"reason":"ok"}
3. Returns false when swarm limit would be exceeded
4. No "array vs string" type errors in output
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-infrastructure/02-04-SUMMARY.md`
</output>
