---
phase: 08-build-polish-output-timing-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - /Users/callumcowie/.claude/commands/ant/build.md
autonomous: true

must_haves:
  truths:
    - "Build command displays worker spawn notifications BEFORE showing completion summary"
    - "All worker Task calls use foreground execution (no run_in_background flags)"
    - "Build summary accurately reflects actual worker completion status"
  artifacts:
    - path: "/Users/callumcowie/.claude/commands/ant/build.md"
      provides: "Fixed timing - run_in_background removed from Steps 5.1, 5.4, 5.4.2"
      contains: "Step 5.1: Spawn Wave 1 Workers (Parallel)" without "run_in_background: true"
  key_links:
    - from: "build.md Step 5.1"
      to: "foreground Task execution"
      via: "removal of run_in_background flag"
      pattern: "Task tool with.*subagent_type.*general-purpose"
---

<objective>
Fix misleading output timing in build.md by removing `run_in_background: true` from all worker spawns.

Purpose: The current build command shows the spawn plan summary BEFORE workers actually complete because `run_in_background: true` returns immediately. This creates a misleading UX where the summary appears before work is done.

Output: Modified build.md with foreground Task execution ensuring output order matches execution order.
</objective>

<execution_context>
@~/.claude/cosmic-dev-system/workflows/execute-plan.md
@~/.claude/cosmic-dev-system/templates/summary.md
</execution_context>

<context>
@/Users/callumcowie/repos/Aether/.planning/ROADMAP.md
@/Users/callumcowie/repos/Aether/.planning/REQUIREMENTS.md
@/Users/callumcowie/repos/Aether/.planning/phases/08-build-polish-output-timing-integration/08-RESEARCH.md
@/Users/callumcowie/.claude/commands/ant/build.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove run_in_background from Step 5.1</name>
  <files>/Users/callumcowie/.claude/commands/ant/build.md</files>
  <action>
    Locate Step 5.1 (line ~312) in build.md. Find the text:
    "For each Wave 1 task, use Task tool with `subagent_type="general-purpose"` and `run_in_background: true`:"

    Change it to:
    "For each Wave 1 task, use Task tool with `subagent_type="general-purpose"`:"

    This removes the `run_in_background: true` flag from Wave 1 worker spawns.

    Verify the change by reading the modified section.
  </action>
  <verify>grep -n "run_in_background" /Users/callumcowie/.claude/commands/ant/build.md | head -5</verify>
  <done>Step 5.1 no longer contains "run_in_background: true"</done>
</task>

<task type="auto">
  <name>Task 2: Remove run_in_background from Steps 5.4 and 5.4.2</name>
  <files>/Users/callumcowie/.claude/commands/ant/build.md</files>
  <action>
    Search the entire build.md file for ALL occurrences of "run_in_background".

    Remove `run_in_background: true` from:
    1. Step 5.4 (Watcher spawn) - if present
    2. Step 5.4.2 (Chaos Ant spawn) - if present
    3. Any other Task tool spawns that use this flag

    The only legitimate use of run_in_background might be in documentation/examples explaining the pattern - remove those references too as they're now outdated.

    After changes, verify:
    - grep "run_in_background" build.md should return no results (or only in comments explaining why it's NOT used)
  </action>
  <verify>grep -c "run_in_background" /Users/callumcowie/.claude/commands/ant/build.md || echo "0 occurrences found (expected)"</verify>
  <done>No occurrences of "run_in_background: true" remain in build.md</done>
</task>

<task type="auto">
  <name>Task 3: Update Step 5.2 documentation</name>
  <files>/Users/callumcowie/.claude/commands/ant/build.md</files>
  <action>
    Locate Step 5.2 "Collect Wave 1 Results (BLOCKING)" (around line 459-475).

    Update the documentation to reflect that with foreground execution, results are already available:

    OLD:
    "For each spawned worker, call TaskOutput with `block: true` to wait for completion:"

    NEW:
    "For each spawned worker, parse the returned result (foreground execution means workers have already completed):"

    Also update Step 5.4.1 if needed to reflect that Watcher results are already available.

    This documentation change clarifies that the "blocking" behavior is now inherent in the Task spawn itself, not a separate collection step.
  </action>
  <verify>grep -A 2 "Step 5.2: Collect Wave 1 Results" /Users/callumcowie/.claude/commands/ant/build.md</verify>
  <done>Step 5.2 documentation updated to reflect foreground execution</done>
</task>

</tasks>

<verification>
1. grep "run_in_background: true" /Users/callumcowie/.claude/commands/ant/build.md returns no results
2. Step 5.1, 5.4, and 5.4.2 all use foreground Task execution
3. Step 5.2 documentation reflects the new execution model
4. File saved and git diff shows only the intended changes
</verification>

<success_criteria>
- BUILD-01 satisfied: All `run_in_background: true` flags removed from worker spawns
- BUILD-02 satisfied: Output will now display in correct order (spawn → complete → summary)
- BUILD-03 satisfied: Foreground Task calls with natural blocking behavior
- No syntax errors or broken references in build.md
</success_criteria>

<output>
After completion, create `.planning/phases/08-build-polish-output-timing-integration/08-01-SUMMARY.md`
</output>
