---
phase: 38-signal-schema-unification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - commands/ant/init.md
  - commands/ant/build.md
  - commands/ant/continue.md
  - commands/ant/plan.md
  - commands/ant/organize.md
  - commands/ant/pause-colony.md
  - commands/ant/resume-colony.md
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "init.md writes INIT signal with TTL schema (priority, expires_at)"
    - "init.md writes signal to COLONY_STATE.json, not pheromones.json"
    - "All signal reads come from COLONY_STATE.json signals array"
    - "All signal writes go to COLONY_STATE.json signals array"
    - "Colony initialization flow works end-to-end"
  artifacts:
    - path: "commands/ant/init.md"
      provides: "TTL schema INIT signal to COLONY_STATE.json"
      contains: "COLONY_STATE.json"
    - path: "commands/ant/build.md"
      provides: "Signal read/write from COLONY_STATE.json"
      contains: "COLONY_STATE.json"
    - path: "commands/ant/continue.md"
      provides: "Signal read/write from COLONY_STATE.json"
      contains: "COLONY_STATE.json"
  key_links:
    - from: "commands/ant/init.md"
      to: "COLONY_STATE.json signals"
      via: "Step 5 signal write"
      pattern: "signals.*priority.*expires_at"
    - from: "commands/ant/build.md"
      to: "COLONY_STATE.json signals"
      via: "Step 3 signal filtering"
      pattern: "COLONY_STATE\\.json.*signals"
    - from: "commands/ant/continue.md"
      to: "COLONY_STATE.json signals"
      via: "Step 4.5 and Step 5 signal operations"
      pattern: "COLONY_STATE\\.json.*signals"
---

<objective>
Unify signal schema and paths across all Aether commands.

Purpose: Phase 36 introduced TTL signal schema but init.md still writes legacy schema to pheromones.json. Phase 37 updated signal emission commands (focus.md, redirect.md, feedback.md) to write to COLONY_STATE.json, but build.md and continue.md still read from pheromones.json. This creates a disconnect where emitted signals never reach build.md.

Output: All 7 affected command files updated to use COLONY_STATE.json signals array with TTL schema.
</objective>

<execution_context>
@~/.claude/cosmic-dev-system/workflows/execute-plan.md
@~/.claude/cosmic-dev-system/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/38-signal-schema-unification/38-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update init.md signal schema and target</name>
  <files>commands/ant/init.md</files>
  <action>
Update init.md Step 5 (lines 106-126) to:

1. Change the step title from "Emit INIT Pheromone" to "Emit INIT Signal"

2. Instead of writing to `.aether/data/pheromones.json`, add the INIT signal to the COLONY_STATE.json written in Step 3. Update Step 3 to include a `signals` array, or if Step 3 already wrote COLONY_STATE.json, read it back and add the signal.

3. Replace the legacy schema:
   ```json
   {
     "id": "init_<unix_timestamp>",
     "type": "INIT",
     "content": "<the user's goal>",
     "strength": 1.0,
     "half_life_seconds": null,
     "created_at": "<ISO-8601 timestamp>"
   }
   ```

   With TTL schema:
   ```json
   {
     "id": "init_<unix_timestamp_ms>",
     "type": "INIT",
     "content": "<the user's goal>",
     "priority": "high",
     "created_at": "<ISO-8601 timestamp>",
     "expires_at": "phase_end",
     "source": "system:init"
   }
   ```

4. Remove the line about "INIT signals have no half-life -- they persist forever" and replace with note that INIT uses `expires_at: "phase_end"` so it persists until phase advances.

5. Update Step 6.5 validation reference to remove pheromones.json from the list of validated files (since it no longer exists).

6. Remove any other references to pheromones.json in the file.

Important: The COLONY_STATE.json written in Step 3 should now include a `signals` array containing the INIT signal, rather than writing signals to a separate file.
  </action>
  <verify>
grep -n "pheromones.json" commands/ant/init.md returns no matches.
grep -n "strength" commands/ant/init.md returns no matches in signal context.
grep -n "half_life" commands/ant/init.md returns no matches.
grep -n "priority.*expires_at" commands/ant/init.md shows the TTL schema.
  </verify>
  <done>init.md writes INIT signal with TTL schema to COLONY_STATE.json signals array, no pheromones.json reference remains.</done>
</task>

<task type="auto">
  <name>Task 2: Update build.md and continue.md signal paths</name>
  <files>commands/ant/build.md, commands/ant/continue.md</files>
  <action>
**build.md updates:**

1. Step 2 (Read State, around line 55-60): Remove `.aether/data/pheromones.json` from the read list. Signals are now in COLONY_STATE.json.

2. Step 3 (Filter Active Signals, around line 68-106): Change "Filter signals from `pheromones.json`" to "Filter signals from `COLONY_STATE.json` signals array".

3. Step 7b (Emit FEEDBACK Signal, around lines 900-916):
   - Change "Read `.aether/data/pheromones.json`" to reference COLONY_STATE.json signals array (already in memory from Step 2).
   - Change "Append the signal to the `signals` array in `pheromones.json`" to "Append to COLONY_STATE.json signals array".

4. Step 7d (around line 948): Remove pheromones.json write reference.

5. Step 7f (Persistence Confirmation): If pheromones.json is mentioned in the "6 files validated" list, update the count/reference.

**continue.md updates:**

1. Step 1 (Read State, around line 21-27): Remove `.aether/data/pheromones.json` from the read list. Signals are now in COLONY_STATE.json.

2. Step 4.5 (Auto-Emit Pheromones, around lines 364-436):
   - Change "Read `.aether/data/pheromones.json`" to reference COLONY_STATE.json signals array.
   - Change signal append operations to target COLONY_STATE.json.
   - Change file write from pheromones.json to COLONY_STATE.json.

3. Step 5 (Filter Phase-End Signals, around lines 438-456):
   - Change "For each signal in pheromones.json signals array" to "For each signal in COLONY_STATE.json signals array".
   - Change "Write the filtered signals array back to `pheromones.json`" to "Write to COLONY_STATE.json".

Important: Preserve all the TTL filtering logic -- just change the file path from pheromones.json to COLONY_STATE.json.
  </action>
  <verify>
grep -n "pheromones.json" commands/ant/build.md returns no matches.
grep -n "pheromones.json" commands/ant/continue.md returns no matches.
grep -c "COLONY_STATE.json" commands/ant/build.md shows increased count (signals now come from there).
grep -c "COLONY_STATE.json" commands/ant/continue.md shows increased count.
  </verify>
  <done>build.md and continue.md read/write signals from COLONY_STATE.json, no pheromones.json references remain.</done>
</task>

<task type="auto">
  <name>Task 3: Update remaining commands (plan, organize, pause, resume)</name>
  <files>commands/ant/plan.md, commands/ant/organize.md, commands/ant/pause-colony.md, commands/ant/resume-colony.md</files>
  <action>
**plan.md updates:**

1. Step 1 (Read State, around lines 12-16): Remove `.aether/data/pheromones.json` from the read list.

2. Step 3 (Compute Active Signals, around lines 30-50): Change "Read `.aether/data/pheromones.json`" to "Use the signals array from COLONY_STATE.json" (already read in Step 1).

**organize.md updates:**

1. Step 1 (Read State, around lines 14-22): Remove `.aether/data/pheromones.json` from the read list.

2. Step 2 (Compute Active Signals, around lines 24-48): Change "Read `.aether/data/pheromones.json`" to "Use the signals array from COLONY_STATE.json".

**pause-colony.md updates:**

1. Step 1 (Read State, around lines 12-16): Remove `.aether/data/pheromones.json` from the read list.

2. Step 2 (Filter Active Signals, around lines 18-35): Change "Filter signals from `pheromones.json`" to "Filter signals from COLONY_STATE.json signals array".

**resume-colony.md updates:**

1. Step 1 (Read State Files, around lines 12-17): Remove `.aether/data/pheromones.json` from the read list.

2. Step 2 (Extend Signal TTLs, around lines 29-50):
   - Change "For each signal in pheromones.json signals array" to "For each signal in COLONY_STATE.json signals array".
   - Change "Write updated pheromones.json" to "Write updated COLONY_STATE.json" (signal TTL extensions go to COLONY_STATE).

3. Step 2.5 (Filter Active Signals, around lines 52-67): Signal filtering already references "signals array" generically; ensure it reads from COLONY_STATE.json.

All updates preserve the TTL filtering logic -- only the file path changes.
  </action>
  <verify>
grep -n "pheromones.json" commands/ant/plan.md returns no matches.
grep -n "pheromones.json" commands/ant/organize.md returns no matches.
grep -n "pheromones.json" commands/ant/pause-colony.md returns no matches.
grep -n "pheromones.json" commands/ant/resume-colony.md returns no matches.
  </verify>
  <done>All 4 remaining commands read/write signals from COLONY_STATE.json, no pheromones.json references remain.</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. No command references pheromones.json:
   ```bash
   grep -r "pheromones.json" commands/ant/*.md
   ```
   Should return empty.

2. All signal operations use COLONY_STATE.json:
   ```bash
   grep -l "COLONY_STATE.json" commands/ant/*.md | wc -l
   ```
   Should include init.md, build.md, continue.md, plan.md, organize.md, pause-colony.md, resume-colony.md.

3. init.md uses TTL schema:
   ```bash
   grep -A 10 "Step 5" commands/ant/init.md | grep -E "priority|expires_at"
   ```
   Should show TTL fields.

4. No legacy schema fields in init.md:
   ```bash
   grep -E "strength|half_life" commands/ant/init.md
   ```
   Should return empty.
</verification>

<success_criteria>
1. init.md writes signals with TTL schema (priority, expires_at) not legacy schema (strength, half_life)
2. All signal commands write to COLONY_STATE.json signals section
3. build.md reads signals from COLONY_STATE.json (not pheromones.json)
4. continue.md reads/writes signals from COLONY_STATE.json
5. plan.md, organize.md, pause-colony.md, resume-colony.md all use COLONY_STATE.json for signals
6. No command file references pheromones.json
</success_criteria>

<output>
After completion, create `.planning/phases/38-signal-schema-unification/38-01-SUMMARY.md`
</output>
