---
phase: 33-state-foundation
plan: 02
type: execute
wave: 2
depends_on: ["33-01"]
files_modified:
  - .claude/commands/ant/init.md
  - .claude/commands/ant/status.md
autonomous: true

must_haves:
  truths:
    - "init.md writes single consolidated COLONY_STATE.json"
    - "status.md reads single consolidated COLONY_STATE.json"
    - "No references to separate state files in either command"
  artifacts:
    - path: ".claude/commands/ant/init.md"
      provides: "Colony initialization"
      min_lines: 50
    - path: ".claude/commands/ant/status.md"
      provides: "Colony status display"
      min_lines: 80
  key_links:
    - from: ".claude/commands/ant/init.md"
      to: ".aether/data/COLONY_STATE.json"
      via: "Single Write call"
      pattern: "Write.*COLONY_STATE"
    - from: ".claude/commands/ant/status.md"
      to: ".aether/data/COLONY_STATE.json"
      via: "Single Read call"
      pattern: "Read.*COLONY_STATE"
---

<objective>
Update init.md and status.md to use the consolidated COLONY_STATE.json.

Purpose: These are the foundational commands - init creates state, status reads it. Updating these first validates the new format works end-to-end.

Output:
- Updated init.md that writes all state to single file
- Updated status.md that reads all state from single file
</objective>

<execution_context>
@~/.claude/cosmic-dev-system/workflows/execute-plan.md
@~/.claude/cosmic-dev-system/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/33-state-foundation/33-RESEARCH.md
@.planning/phases/33-state-foundation/33-01-SUMMARY.md

# Current commands to update
@.claude/commands/ant/init.md
@.claude/commands/ant/status.md

# New state format reference
@.aether/data/COLONY_STATE.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update init.md for consolidated state</name>
  <files>.claude/commands/ant/init.md</files>
  <action>
Refactor init.md to write a single COLONY_STATE.json file instead of 5 separate files.

Changes:
1. Remove Step 4 (Create State Files) - no longer creates errors.json, memory.json, events.json separately
2. Merge Step 5 (Emit INIT Pheromone) into Step 3 (Write Colony State)
3. Merge Step 6 (Write Init Event) into Step 3

The new Step 3 writes ONE file with the full v2.0 structure:
```json
{
  "version": "2.0",
  "goal": "<user's goal>",
  "state": "READY",
  "current_phase": 0,
  "session_id": "<generated>",
  "initialized_at": "<timestamp>",
  "mode": null,
  "mode_set_at": null,
  "mode_indicators": null,
  "workers": { ... all 6 workers: "idle" ... },
  "spawn_outcomes": { ... all 6 castes with alpha/beta 1/1 ... },
  "plan": {
    "generated_at": null,
    "phases": []
  },
  "signals": [
    {
      "id": "init_<timestamp>",
      "type": "INIT",
      "content": "<user's goal>",
      "strength": 1.0,
      "half_life_seconds": null,
      "created_at": "<timestamp>"
    }
  ],
  "memory": {
    "phase_learnings": [],
    "decisions": [],
    "patterns": []
  },
  "errors": {
    "records": [],
    "flagged_patterns": []
  },
  "events": [
    "<timestamp> | colony_initialized | init | Colony initialized with goal: <goal>"
  ]
}
```

4. Update Step 6.5 (Validate State Files) to validate single file only
5. Update step numbering to reflect removed steps
6. Keep the display output format in Step 7 (it's fine as-is)

Remove ALL references to:
- `.aether/data/errors.json`
- `.aether/data/memory.json`
- `.aether/data/events.json`
- `.aether/data/pheromones.json`
  </action>
  <verify>
`grep -c "errors.json\|memory.json\|events.json\|pheromones.json" .claude/commands/ant/init.md` returns 0
File contains `version.*2.0` in the JSON template
  </verify>
  <done>
init.md writes single consolidated COLONY_STATE.json with v2.0 format
  </done>
</task>

<task type="auto">
  <name>Task 2: Update status.md for consolidated state</name>
  <files>.claude/commands/ant/status.md</files>
  <action>
Refactor status.md to read from single COLONY_STATE.json instead of 6 separate files.

Changes:
1. Step 1 (Read State): Read ONLY `.aether/data/COLONY_STATE.json`
   - Remove the list of 6 files to read in parallel
   - Extract sections from the consolidated structure:
     - goal, state, session_id, current_phase from top level
     - workers, spawn_outcomes from top level
     - plan.phases for phase progress
     - signals for pheromones
     - memory.phase_learnings, memory.decisions for memory display
     - errors.records, errors.flagged_patterns for error display
     - events for event display

2. Keep pheromone decay computation (Step 2) - still calls aether-utils.sh
   Note: Phase 36 will simplify this to TTL, but for now keep existing decay math

3. Keep pheromone cleanup (Step 2.5) - still calls aether-utils.sh
   But write back to consolidated COLONY_STATE.json signals array

4. Keep ALL display sections (WORKERS, PHEROMONES, ERRORS, MEMORY, EVENTS, etc.)
   - Just change where data is extracted from

5. Update event parsing for new string format:
   - Old: `{type: "colony_initialized", content: "msg", timestamp: "..."}`
   - New: `"2026-... | colony_initialized | init | msg"`
   - Parse by splitting on " | "

Remove ALL references to reading from:
- `.aether/data/PROJECT_PLAN.json`
- `.aether/data/pheromones.json`
- `.aether/data/memory.json`
- `.aether/data/errors.json`
- `.aether/data/events.json`
  </action>
  <verify>
Step 1 references only `.aether/data/COLONY_STATE.json`
Event display parses pipe-delimited strings
`grep -c "PROJECT_PLAN.json\|memory.json\|events.json\|errors.json" .claude/commands/ant/status.md` returns 0
  </verify>
  <done>
status.md reads all state from single consolidated COLONY_STATE.json
  </done>
</task>

</tasks>

<verification>
1. `grep -r "PROJECT_PLAN.json\|pheromones.json\|memory.json\|errors.json\|events.json" .claude/commands/ant/init.md .claude/commands/ant/status.md` returns empty
2. Both files reference only `.aether/data/COLONY_STATE.json` for state
3. init.md JSON template includes version: "2.0"
4. status.md can parse event strings in format "timestamp | type | source | content"
</verification>

<success_criteria>
- init.md creates single COLONY_STATE.json with all sections
- status.md reads single COLONY_STATE.json and displays all sections
- No references to old separate state files
- Event string format supported in status display
</success_criteria>

<output>
After completion, create `.planning/phases/33-state-foundation/33-02-SUMMARY.md`
</output>
