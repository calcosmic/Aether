---
phase: 33-state-foundation
plan: 03
type: execute
wave: 2
depends_on: ["33-01"]
files_modified:
  - .claude/commands/ant/focus.md
  - .claude/commands/ant/redirect.md
  - .claude/commands/ant/feedback.md
  - .claude/commands/ant/phase.md
  - .claude/commands/ant/pause-colony.md
  - .claude/commands/ant/resume-colony.md
autonomous: true

must_haves:
  truths:
    - "All 6 commands read from single COLONY_STATE.json"
    - "Signal commands write back to consolidated signals array"
    - "No references to separate pheromones.json, memory.json, or events.json"
  artifacts:
    - path: ".claude/commands/ant/focus.md"
      provides: "FOCUS signal emission"
    - path: ".claude/commands/ant/redirect.md"
      provides: "REDIRECT signal emission"
    - path: ".claude/commands/ant/feedback.md"
      provides: "FEEDBACK signal emission"
    - path: ".claude/commands/ant/phase.md"
      provides: "Phase display"
    - path: ".claude/commands/ant/pause-colony.md"
      provides: "Colony pause for handoff"
    - path: ".claude/commands/ant/resume-colony.md"
      provides: "Colony resume from handoff"
  key_links:
    - from: ".claude/commands/ant/focus.md"
      to: ".aether/data/COLONY_STATE.json"
      via: "Read state, append signal, write back"
      pattern: "signals.*FOCUS"
---

<objective>
Update signal commands and read-only commands to use consolidated COLONY_STATE.json.

Purpose: These 6 commands share similar patterns - signal commands append to signals/memory/events arrays, read-only commands just display state. Batching them keeps related changes together.

Output:
- Updated focus.md, redirect.md, feedback.md (signal emission)
- Updated phase.md, pause-colony.md, resume-colony.md (read-only display)
</objective>

<execution_context>
@~/.claude/cosmic-dev-system/workflows/execute-plan.md
@~/.claude/cosmic-dev-system/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/33-state-foundation/33-RESEARCH.md
@.planning/phases/33-state-foundation/33-01-SUMMARY.md

# Commands to update
@.claude/commands/ant/focus.md
@.claude/commands/ant/redirect.md
@.claude/commands/ant/feedback.md
@.claude/commands/ant/phase.md
@.claude/commands/ant/pause-colony.md
@.claude/commands/ant/resume-colony.md

# State format reference
@.aether/data/COLONY_STATE.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update signal commands (focus, redirect, feedback)</name>
  <files>.claude/commands/ant/focus.md, .claude/commands/ant/redirect.md, .claude/commands/ant/feedback.md</files>
  <action>
All three signal commands have identical structure. Update each:

1. Step 2 (Read State): Read only `.aether/data/COLONY_STATE.json`
   - Extract goal from top level
   - Extract current_phase from top level

2. Step 3 (Append Signal):
   - Read `.aether/data/COLONY_STATE.json`
   - Append new signal to the `signals` array
   - Write back the FULL state (not just signals)

3. Step 4 (Log Decision):
   - Read `.aether/data/COLONY_STATE.json` (if not already in memory)
   - Append to `memory.decisions` array
   - Keep 30-entry limit
   - Write back the FULL state

4. Step 5 (Write Event):
   - Append to `events` array as pipe-delimited string:
     `"<timestamp> | pheromone_emitted | <focus|redirect|feedback> | <TYPE>: <content> (strength X, half-life Y)"`
   - Keep 100-entry limit
   - Write back the FULL state

Key: Merge steps 3, 4, 5 into a single read-modify-write cycle:
- Read COLONY_STATE.json once
- Modify signals array (append new signal)
- Modify memory.decisions array (append decision, trim to 30)
- Modify events array (append event string, trim to 100)
- Write COLONY_STATE.json once

Remove ALL references to:
- `.aether/data/pheromones.json`
- `.aether/data/memory.json`
- `.aether/data/events.json`
  </action>
  <verify>
`grep -l "pheromones.json\|memory.json\|events.json" .claude/commands/ant/focus.md .claude/commands/ant/redirect.md .claude/commands/ant/feedback.md` returns empty
Each command has single read-modify-write cycle for state
  </verify>
  <done>
All three signal commands use consolidated COLONY_STATE.json
  </done>
</task>

<task type="auto">
  <name>Task 2: Update read-only commands (phase, pause-colony, resume-colony)</name>
  <files>.claude/commands/ant/phase.md, .claude/commands/ant/pause-colony.md, .claude/commands/ant/resume-colony.md</files>
  <action>
Update each read-only command:

**phase.md:**
1. Step 1: Read only `.aether/data/COLONY_STATE.json`
2. Extract phases from `plan.phases` (not separate PROJECT_PLAN.json)
3. Extract current_phase from top level
4. Remove references to PROJECT_PLAN.json

**pause-colony.md:**
1. Read state: Read only `.aether/data/COLONY_STATE.json`
2. Extract from consolidated structure:
   - goal, state, current_phase from top level
   - plan.phases for phase info
   - signals for active pheromones
3. Write HANDOFF.md (this is correct - handoff is separate file)
4. Remove references to PROJECT_PLAN.json, pheromones.json

**resume-colony.md:**
1. Read state: Read only `.aether/data/COLONY_STATE.json`
2. Read HANDOFF.md (this is correct)
3. Extract from consolidated structure for display
4. Remove references to PROJECT_PLAN.json, pheromones.json

Remove ALL references to:
- `.aether/data/PROJECT_PLAN.json`
- `.aether/data/pheromones.json`
  </action>
  <verify>
`grep -l "PROJECT_PLAN.json\|pheromones.json" .claude/commands/ant/phase.md .claude/commands/ant/pause-colony.md .claude/commands/ant/resume-colony.md` returns empty
All commands reference only `.aether/data/COLONY_STATE.json` for state
  </verify>
  <done>
Read-only commands use consolidated COLONY_STATE.json
  </done>
</task>

</tasks>

<verification>
1. `grep -r "pheromones.json\|memory.json\|events.json\|PROJECT_PLAN.json" .claude/commands/ant/focus.md .claude/commands/ant/redirect.md .claude/commands/ant/feedback.md .claude/commands/ant/phase.md .claude/commands/ant/pause-colony.md .claude/commands/ant/resume-colony.md` returns empty
2. Signal commands have single read-modify-write cycle
3. All 6 commands reference `.aether/data/COLONY_STATE.json`
</verification>

<success_criteria>
- Signal commands append to consolidated signals/memory/events
- Read-only commands extract data from consolidated structure
- No references to old separate state files
- Event strings use pipe-delimited format
</success_criteria>

<output>
After completion, create `.planning/phases/33-state-foundation/33-03-SUMMARY.md`
</output>
