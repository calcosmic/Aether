---
phase: 10-entombment-egg-laying
plan: 04
type: execute
wave: 4
depends_on: ["10-01", "10-02", "10-03"]
files_modified:
  - .claude/commands/ant/tunnels.md
  - .opencode/commands/ant/tunnels.md
autonomous: false
user_setup: []

must_haves:
  truths:
    - User can run /ant:tunnels to browse archived colonies
    - Tunnel view shows list of chambers with summaries
    - User can view detailed chamber info with /ant:tunnels <name>
    - Chambers sorted by entombment date (newest first)
    - Empty chambers directory shows helpful message
  artifacts:
    - path: ".claude/commands/ant/tunnels.md"
      provides: "Tunnels command for browsing chambers"
      contains: ["ant:tunnels", "chambers", "explore"]
    - path: ".opencode/commands/ant/tunnels.md"
      provides: "Tunnels command for OpenCode"
      contains: ["ant:tunnels", "chambers", "explore"]
  key_links:
    - from: ".claude/commands/ant/tunnels.md"
      to: ".aether/aether-utils.sh"
      via: "chamber-list and chamber-verify subcommands"
      pattern: "bash .aether/aether-utils.sh chamber-"
---

<objective>
Implement the `/ant:tunnels` command for browsing archived colonies.

Purpose: Allow users to explore colony history by viewing entombed chambers with summaries and details.
Output: tunnels.md command files for both Claude Code and OpenCode
</objective>

<execution_context>
@~/.claude/cosmic-dev-system/workflows/execute-plan.md
@~/.claude/cosmic-dev-system/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-entombment-egg-laying/10-CONTEXT.md
@.planning/phases/10-entombment-egg-laying/10-RESEARCH.md
@.claude/commands/ant/status.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create /ant:tunnels command for Claude Code</name>
  <files>.claude/commands/ant/tunnels.md</files>
  <action>
Create `.claude/commands/ant/tunnels.md` following the pattern from RESEARCH.md:

**Frontmatter:**
```yaml
---
name: ant:tunnels
description: "ğŸ•³ï¸ğŸœğŸ•³ï¸ Explore tunnels (browse archived colonies)"
---
```

**Instructions structure:**

### Step 1: Check for Chambers Directory
- Check if `.aether/chambers/` exists
- If not:
  ```
  ğŸ•³ï¸ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     T U N N E L S   (Colony History)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ğŸ•³ï¸

  No chambers found.

  Archive colonies with /ant:entomb to build the tunnel network.
  ```
  Stop here.

### Step 2: List All Chambers
Run: `bash .aether/aether-utils.sh chamber-list`

Parse JSON result into array of chambers.

If no chambers (empty array):
```
ğŸ•³ï¸ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   T U N N E L S   (Colony History)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ğŸ•³ï¸

Chambers: 0 colonies archived

The tunnel network is empty.
Archive colonies with /ant:entomb to preserve history.
```

### Step 3: Handle Detail View (if argument provided)
If `$ARGUMENTS` is not empty:
- Treat it as chamber name
- Check if `.aether/chambers/{arguments}/` exists
- If not found:
  ```
  Chamber not found: {arguments}

  Run /ant:tunnels to see available chambers.
  ```
  Stop here.

- If found, read manifest.json and display detailed view:
```
ğŸ•³ï¸ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   C H A M B E R   D E T A I L S
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ğŸ•³ï¸

ğŸ“¦ {chamber_name}

ğŸ‘‘ Goal:
   {goal}

ğŸ† Milestone: {milestone} ({version})
ğŸ“ Progress: {phases_completed} of {total_phases} phases
ğŸ“… Entombed: {entombed_at}

{If decisions exist:}
ğŸ§  Decisions Preserved:
   {N} architectural decisions recorded
{End if}

{If learnings exist:}
ğŸ’¡ Learnings Preserved:
   {N} validated learnings recorded
{End if}

ğŸ“ Files:
   - COLONY_STATE.json (verified: {hash_status})
   - manifest.json

Run /ant:tunnels to return to chamber list.
```

### Step 4: Display Chamber List (default view)
```
ğŸ•³ï¸ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   T U N N E L S   (Colony History)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ğŸ•³ï¸

Chambers: {count} colonies archived

{For each chamber in sorted list:}
ğŸ“¦ {chamber_name}
   ğŸ‘‘ {goal (truncated to 50 chars)}
   ğŸ† {milestone} ({version})
   ğŸ“ {phases_completed} phases | ğŸ“… {date}

{End for}

Run /ant:tunnels <chamber_name> to view details
```

**Formatting details:**
- Sort by entombed_at descending (newest first)
- Truncate goal to 50 characters with "..." if longer
- Format date as YYYY-MM-DD from ISO timestamp
- Show chamber count at top

**Edge cases:**
- Malformed manifest: show "âš ï¸  Invalid manifest" for that chamber
- Missing COLONY_STATE.json: show "âš ï¸  Incomplete chamber"
- Very long chamber list: display all (no pagination for now)
  </action>
  <verify>
grep -q "name: ant:tunnels" .claude/commands/ant/tunnels.md
grep -q "chamber-list" .claude/commands/ant/tunnels.md
grep -q "ğŸ•³ï¸" .claude/commands/ant/tunnels.md
echo "tunnels.md structure validated"
  </verify>
  <done>tunnels.md exists with complete command structure, list view, and detail view</done>
</task>

<task type="auto">
  <name>Task 2: Mirror tunnels command to OpenCode</name>
  <files>.opencode/commands/ant/tunnels.md</files>
  <action>
Create `.opencode/commands/ant/tunnels.md` as an exact copy of `.claude/commands/ant/tunnels.md`.

The commands are identical between Claude Code and OpenCode.

Ensure the directory exists first.
  </action>
  <verify>
test -f .opencode/commands/ant/tunnels.md
diff .claude/commands/ant/tunnels.md .opencode/commands/ant/tunnels.md
echo "OpenCode mirror created and matches"
  </verify>
  <done>OpenCode tunnels.md exists and is identical to Claude Code version</done>
</task>

<task type="checkpoint:human-verify">
  <name>Task 3: Verify tunnels command works end-to-end</name>
  <what-built>
/ant:tunnels command that:
1. Lists all entombed chambers with summaries
2. Shows chamber name, goal (truncated), milestone, version, phases, date
3. Supports detail view with /ant:tunnels <chamber_name>
4. Displays helpful message when no chambers exist
5. Sorts chambers by entombment date (newest first)
  </what-built>
  <how-to-verify>
1. Test with no chambers:
   - If no chambers exist, run `/ant:tunnels`
   - Verify: Shows "No chambers found" message with guidance

2. Test chamber listing (requires at least one entombed colony):
   - Run `/ant:tunnels`
   - Verify:
     - Header shows chamber count
     - Each chamber shows: name, goal (truncated to 50 chars), milestone, version, phases completed, date
     - Chambers sorted by date (newest first)
     - Footer shows how to view details

3. Test detail view:
   - Run `/ant:tunnels <chamber_name>` with a valid chamber
   - Verify:
     - Shows full goal
     - Shows milestone with version
     - Shows phases completed / total
     - Shows entombment date
     - Shows decisions count (if any)
     - Shows learnings count (if any)
     - Shows file verification status

4. Test error cases:
   - Run `/ant:tunnels nonexistent` - should show "Chamber not found"
  </how-to-verify>
  <resume-signal>Type "approved" if tunnels command works correctly</resume-signal>
</task>

</tasks>

<verification>
- [ ] tunnels.md exists for Claude Code
- [ ] tunnels.md exists for OpenCode (mirror)
- [ ] Command lists chambers with chamber-list subcommand
- [ ] List view shows name, goal, milestone, version, phases, date
- [ ] Detail view shows full manifest data
- [ ] Empty chambers directory shows helpful message
- [ ] Invalid chamber name shows error
</verification>

<success_criteria>
1. User can run `/ant:tunnels` to see list of archived colonies
2. Each chamber shows: name, goal, milestone, version, phases, date
3. User can run `/ant:tunnels <name>` to see detailed chamber info
4. Chambers sorted by entombment date (newest first)
5. Empty state provides clear guidance
</success_criteria>

<output>
After completion, create `.planning/phases/10-entombment-egg-laying/10-04-SUMMARY.md`
</output>
