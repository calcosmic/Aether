---
phase: 15-infrastructure-state
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude/commands/ant/init.md
autonomous: true

must_haves:
  truths:
    - "Running /ant:init creates errors.json with {errors: [], flagged_patterns: []} in .aether/data/"
    - "Running /ant:init creates memory.json with {phase_learnings: [], decisions: [], patterns: []} in .aether/data/"
    - "Running /ant:init creates events.json with {events: []} in .aether/data/"
    - "After /ant:init completes, events.json contains a colony_initialized event record"
  artifacts:
    - path: ".claude/commands/ant/init.md"
      provides: "State file initialization + init event writing"
      contains: "errors.json"
  key_links:
    - from: ".claude/commands/ant/init.md"
      to: ".aether/data/errors.json"
      via: "Write tool in Step 4"
      pattern: "errors\\.json"
    - from: ".claude/commands/ant/init.md"
      to: ".aether/data/memory.json"
      via: "Write tool in Step 4"
      pattern: "memory\\.json"
    - from: ".claude/commands/ant/init.md"
      to: ".aether/data/events.json"
      via: "Write tool in Step 4 and Step 6"
      pattern: "events\\.json"
---

<objective>
Add JSON state file initialization (errors.json, memory.json, events.json) and init event writing to init.md.

Purpose: Establishes the data layer that all subsequent Phase 15 commands (build, continue, focus, redirect, feedback) and future phases (Worker Knowledge, Dashboard) depend on. Without init creating these files, no other command can read/write state.

Output: Modified init.md with two new steps -- state file creation (Step 4) and init event writing (Step 6).
</objective>

<execution_context>
@~/.claude/cosmic-dev-system/workflows/execute-plan.md
@~/.claude/cosmic-dev-system/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-infrastructure-state/15-RESEARCH.md
@.claude/commands/ant/init.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add state file creation and init event to init.md</name>
  <files>.claude/commands/ant/init.md</files>
  <action>
Modify `.claude/commands/ant/init.md` to add two new steps and update step numbering. The current flow is:

```
Step 1: Validate Input
Step 2: Read Current State
Step 3: Write Colony State
Step 4: Emit INIT Pheromone
Step 5: Display Result
```

The new flow must be:

```
Step 1: Validate Input (unchanged)
Step 2: Read Current State (unchanged)
Step 3: Write Colony State (unchanged)
Step 4: Create State Files (NEW)
Step 5: Emit INIT Pheromone (renumbered from 4)
Step 6: Write Init Event (NEW)
Step 7: Display Result (renumbered from 5)
```

**Step 4: Create State Files** -- Insert between current Step 3 and Step 4. Content:

```markdown
### Step 4: Create State Files

Use the Write tool to create these three files:

**`.aether/data/errors.json`:**
```json
{
  "errors": [],
  "flagged_patterns": []
}
```

**`.aether/data/memory.json`:**
```json
{
  "phase_learnings": [],
  "decisions": [],
  "patterns": []
}
```

**`.aether/data/events.json`:**
```json
{
  "events": []
}
```
```

**Step 6: Write Init Event** -- Insert after renumbered Step 5 (Emit INIT Pheromone). Content:

```markdown
### Step 6: Write Init Event

Read `.aether/data/events.json`. Append to the `events` array:

```json
{
  "id": "evt_<unix_timestamp>_<4_random_hex>",
  "type": "colony_initialized",
  "source": "init",
  "content": "Colony initialized with goal: <the user's goal>",
  "timestamp": "<ISO-8601 UTC>"
}
```

Use the Write tool to write the updated events.json.
```

**Step 7: Display Result** -- Update the step progress display to show all 7 steps:

```
  ✓ Step 1: Validate Input
  ✓ Step 2: Read Current State
  ✓ Step 3: Write Colony State
  ✓ Step 4: Create State Files
  ✓ Step 5: Emit INIT Pheromone
  ✓ Step 6: Write Init Event
  ✓ Step 7: Display Result
```

Keep the rest of the Display Result step (header, divider, colony info, next steps) unchanged.

IMPORTANT: The header must remain exactly as Phase 14 established:
```
+=====================================================+
|  AETHER COLONY :: INIT                               |
+=====================================================+
```

Do NOT change any existing step content -- only insert the two new steps and update step numbers/progress display.
  </action>
  <verify>
Read the modified init.md and verify:
1. File has 7 numbered steps (Step 1 through Step 7)
2. Step 4 creates errors.json, memory.json, and events.json with correct initial schemas
3. Step 6 writes a colony_initialized event to events.json
4. Step 7 step progress display lists all 7 steps with checkmarks
5. Box-drawing header is preserved unchanged
6. All original step content is preserved (only numbering changed for steps 4->5 and 5->7)
  </verify>
  <done>init.md contains 7 steps: validate, read state, write colony state, create state files, emit pheromone, write init event, display result. Step progress shows all 7 steps. State file schemas match research spec exactly.</done>
</task>

</tasks>

<verification>
- Read the modified `.claude/commands/ant/init.md` end to end
- Confirm 7 steps present with correct numbering
- Confirm Step 4 creates all 3 JSON files with exact schemas: `{errors: [], flagged_patterns: []}`, `{phase_learnings: [], decisions: [], patterns: []}`, `{events: []}`
- Confirm Step 6 writes event with fields: id, type (colony_initialized), source (init), content, timestamp
- Confirm Step 7 step progress has 7 lines
- Confirm box-drawing header preserved
- Confirm file is approximately 160 lines (not bloated)
</verification>

<success_criteria>
- init.md has exactly 7 numbered steps
- Step 4 creates errors.json, memory.json, events.json with correct empty schemas
- Step 6 appends colony_initialized event to events.json
- Step progress display shows all 7 steps
- No existing functionality changed (only additions + renumbering)
</success_criteria>

<output>
After completion, create `.planning/phases/15-infrastructure-state/15-01-SUMMARY.md`
</output>
