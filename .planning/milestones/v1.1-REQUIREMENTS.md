# Requirements Archive: v1.1 Bug Fixes & Update System Repair

**Archived:** 2026-02-14
**Status:** ✅ SHIPPED

This is the archived requirements specification for v1.1.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

# Requirements: Aether Colony System v1.1

**Defined:** 2026-02-14
**Core Value:** Autonomous multi-agent orchestration that scales from single-user development to team collaboration, with pheromone-based constraints guiding agent behavior.

## v1.1 Requirements

Critical bug fixes and reliability improvements for the v1.0 infrastructure.

### Data Safety

- [x] **SAFE-01**: Git checkpoint system only captures Aether-managed files (never user data)
- [x] **SAFE-02**: Explicit allowlist for checkpoint files: `.aether/*.md`, `.claude/commands/ant/`, `.opencode/commands/ant/`, `.opencode/agents/`, `runtime/`, `bin/cli.js`
- [x] **SAFE-03**: User data explicitly excluded: `TO-DOs.md`, `.aether/data/`, `.aether/dreams/`, `.aether/oracle/`
- [x] **SAFE-04**: Checkpoint metadata includes file hashes for integrity verification

### Build Reliability

- [x] **BUILD-01**: Remove `run_in_background: true` from build.md worker spawns (Steps 5.1, 5.4, 5.4.2)
- [x] **BUILD-02**: Output timing fixed — summary displays after all agent notifications complete
- [x] **BUILD-03**: Foreground Task calls with blocking TaskOutput collection

### State Management

- [x] **STATE-01**: Phase advancement requires fresh verification evidence (Iron Law enforcement)
- [x] **STATE-02**: Idempotency check prevents re-building already-completed phases
- [x] **STATE-03**: State lock acquired during phase transitions (prevents concurrent modification)
- [x] **STATE-04**: Phase transition audit trail in COLONY_STATE.json events

### Update System

- [x] **UPDATE-01**: Update command uses safe checkpoint before file sync
- [x] **UPDATE-02**: Two-phase commit: backup → sync → verify → update version
- [x] **UPDATE-03**: Automatic rollback on sync failure
- [x] **UPDATE-04**: Stash recovery commands displayed prominently on failure
- [x] **UPDATE-05**: Better error handling for dirty repos, network failures, partial updates

### Testing Infrastructure

- [x] **TEST-01**: package-lock.json committed for deterministic builds
- [x] **TEST-02**: Unit tests for `syncDirWithCleanup` function
- [x] **TEST-03**: Unit tests for `hashFileSync` function
- [x] **TEST-04**: Unit tests for `generateManifest` function
- [x] **TEST-05**: Mock filesystem using sinon + proxyquire
- [x] **TEST-06**: Idempotency property tests for sync operations

### Initialization (Added v1.1)

- [x] **INIT-01**: `aether init` copies system files from hub to repo
- [x] **INIT-02**: `aether init` registers repo in global registry for `update --all`
- [x] **INIT-03**: `aether init` creates version.json with hub version

## v2 Requirements (Deferred)

### Future Improvements

- **NOTIFY-01**: Version-aware update notifications (non-blocking check at command start)
- **RECOVER-01**: Checkpoint recovery tracking with auto-suggest
- **METRICS-01**: Update success/failure metrics

## Out of Scope

| Feature | Reason |
|---------|--------|
| New worker castes | Out of scope for bug fix release — defer to v1.2 |
| Enhanced visualization | Feature addition, not a bug fix — defer to v1.2 |
| Real-time monitoring improvements | Feature addition, not a bug fix — defer to v1.2 |
| Cross-repo collaboration | Feature addition, not a bug fix — defer to v1.2 |
| Web UI | CLI-first approach — target v2+ |
| Cloud deployment | Local-first design — target v2+ |

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| SAFE-01 | 6 | Complete |
| SAFE-02 | 6 | Complete |
| SAFE-03 | 6 | Complete |
| SAFE-04 | 6 | Complete |
| TEST-01 | 6 | Complete |
| TEST-02 | 6 | Complete |
| TEST-03 | 6 | Complete |
| TEST-04 | 6 | Complete |
| TEST-05 | 6 | Complete |
| TEST-06 | 6 | Complete |
| STATE-01 | 7 | Complete |
| STATE-02 | 7 | Complete |
| STATE-03 | 7 | Complete |
| STATE-04 | 7 | Complete |
| UPDATE-01 | 7 | Complete |
| UPDATE-02 | 7 | Complete |
| UPDATE-03 | 7 | Complete |
| UPDATE-04 | 7 | Complete |
| UPDATE-05 | 7 | Complete |
| BUILD-01 | 8 | Complete |
| BUILD-02 | 8 | Complete |
| BUILD-03 | 8 | Complete |
| INIT-01 | 7 | Complete |
| INIT-02 | 7 | Complete |
| INIT-03 | 7 | Complete |

**Coverage:**
- v1.1 requirements: 25 total
- Mapped to phases: 25
- Unmapped: 0 ✓

---

## Milestone Summary

**Shipped:** 25 of 25 v1.1 requirements
**Adjusted:** INIT-01/02/03 added during milestone (init improvements)
**Dropped:** None

**Key Outcomes:**
- User data protected via explicit checkpoint allowlist
- Phase advancement loops prevented via Iron Law enforcement
- Update system reliability achieved via two-phase commit with automatic rollback
- Build output timing fixed via foreground execution
- New repos now properly initialized with system files and auto-registered

---

*Archived: 2026-02-14 as part of v1.1 milestone completion*
