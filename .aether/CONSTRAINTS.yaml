# AETHER Constraints (Auto-Generated)
# Generated: 2026-02-01
# Version: 0.1.0

constraints:
  # Context Management Constraints
  - id: CONTEXT-001
    category: context
    severity: CRITICAL
    title: Always start with minimal context
    description: Load only what's needed for current gate, not entire codebase
    impact: HIGH - Causes context rot, slow responses, quality degradation
    dont:
      - Load entire codebase at start
      - Keep stale context across phases
      - Exceed 50k tokens per gate
    do:
      - Load only files needed for current task
      - Clear context between gates
      - Use context compression for archived info
    verified: true
    auto_flag: true

  - id: CONTEXT-002
    category: context
    severity: HIGH
    title: Prompt user before clearing context
    description: Always prompt user at gate completion before clearing context
    impact: MEDIUM - User may lose context if not prompted
    dont:
      - Clear context without user confirmation
      - Skip gate completion verification
    do:
      - Show gate completion summary
      - Prompt for context clear confirmation
      - Wait for user input
    verified: true
    auto_flag: true

  # Source Truth Constraints
  - id: SOURCE-001
    category: source
    severity: CRITICAL
    title: Always use stdlib/ first for patterns
    description: stdlib/ contains verified patterns, always check here first
    impact: HIGH - Using unverified patterns propagates errors
    dont:
      - Copy from work/ (WIP, unverified)
      - Skip stdlib/ when looking for patterns
      - Use examples/ without checking stdlib/ first
    do:
      - Always search stdlib/ first
      - Then search examples/
      - Only use work/ as last resort
    verified: true
    auto_flag: true

  # Error Prevention Constraints
  - id: ERROR-001
    category: error
    severity: HIGH
    title: Log all errors to ERROR_LEDGER.md
    description: Every error must be logged with symptom, root cause, fix, prevention
    impact: HIGH - Without logging, errors repeat
    dont:
      - Fix errors without logging
      - Use vague error descriptions
      - Skip prevention action documentation
    do:
      - Log immediately when error discovered
      - Be specific about root cause
      - Always add prevention action
    verified: true
    auto_flag: true

  - id: ERROR-002
    category: error
    severity: HIGH
    title: Auto-flag after 3 occurrences of same error category
    description: Recurring errors indicate systemic issues requiring constraint
    impact: HIGH - Repeated errors waste time and indicate poor prevention
    dont:
      - Ignore recurring errors
      - Log same error 4+ times without flagging
    do:
      - Track error categories
      - Auto-flag when threshold reached
      - Create constraint for recurring errors
    verified: true
    auto_flag: true

  # Gate Validation Constraints
  - id: GATE-001
    category: gate
    severity: CRITICAL
    title: Never skip verification gates
    description: Each gate must complete and pass verification before proceeding
    impact: HIGH - Skipping gates compounds errors
    dont:
      - Skip gates to "save time"
      - Proceed with failing gate
      - Mark gate complete without verification
    do:
      - Complete each gate fully
      - Verify gate completion
      - Fix any failures before proceeding
    verified: true
    auto_flag: true

  # Session Management Constraints
  - id: SESSION-001
    category: session
    severity: HIGH
    title: Always pause with context handoff
    description: Before ending session, create CONTEXT_HANDOFF.md with full state
    impact: MEDIUM - Lost context requires work reconstruction
    dont:
      - End session without handoff
      - Leave work in ambiguous state
    do:
      - Create CONTEXT_HANDOFF.md
      - Document current state
      - Specify next session actions
    verified: true
    auto_flag: true

  - id: SESSION-002
    category: session
    severity: HIGH
    title: Always check flagged issues on resume
    description: Session start must show FLAGGED_ISSUES and block until acknowledged
    impact: HIGH - Unaddressed flags cause recurring errors
    dont:
      - Skip flagged issues check
      - Proceed without acknowledging flags
    do:
      - Check FLAGGED_ISSUES.md on resume
      - Block until acknowledged
      - Show flag count prominently
    verified: true
    auto_flag: true

  # Guardrail Constraints
  - id: GUARD-001
    category: guardrail
    severity: CRITICAL
    title: Validate BEFORE write, not after
    description: All file writes must pass guardrail validation before execution
    impact: HIGH - Post-validation allows errors to execute
    dont:
      - Write files then validate
      - Bypass guardrails for "speed"
    do:
      - Validate path before write
      - Validate content before write
      - Block writes that fail validation
    verified: true
    auto_flag: true

  # Git Constraints
  - id: GIT-001
    category: git
    severity: MEDIUM
    title: Atomic commits per task
    description: Each completed task gets its own commit immediately
    impact: MEDIUM - Large commits obscure changes and hinder bisect
    dont:
      - Batch multiple tasks in one commit
      - Leave work uncommitted for long periods
    do:
      - Commit immediately after task completion
      - Use descriptive commit messages
      - Keep commits atomic
    verified: true
    auto_flag: true

# Error Categories for Auto-Flagging
error_categories:
  - id: context:overload
    threshold: 3
    description: Too much context loaded
    severity: HIGH

  - id: context:missing
    threshold: 3
    description: Critical context not loaded
    severity: HIGH

  - id: pattern:wrong-source
    threshold: 3
    description: Used work/ instead of stdlib/ or examples/
    severity: HIGH

  - id: pattern:anti
    threshold: 3
    description: Used anti-pattern instead of pattern
    severity: MEDIUM

  - id: constraint:violation
    threshold: 3
    description: Violated known constraint
    severity: HIGH

  - id: gate:skipped
    threshold: 2
    description: Skipped verification gate
    severity: CRITICAL

  - id: gate:failing
    threshold: 3
    description: Proceeded with failing gate
    severity: HIGH

  - id: test:missing
    threshold: 3
    description: Skipped verification gate
    severity: MEDIUM

  - id: test:failing
    threshold: 3
    description: Tests fail without fix
    severity: HIGH

  - id: git:bad-commit
    threshold: 5
    description: Commit message doesn't follow convention
    severity: LOW

  - id: dependency:unstable
    threshold: 3
    description: Used unstable dependency
    severity: MEDIUM

  - id: architecture:drift
    threshold: 2
    description: Deviated from planned architecture
    severity: HIGH
