---
phase: 04-cli-improvements
plan: 03
type: execute
wave: 3
depends_on: ["04-02"]
files_modified:
  - bin/cli.js
autonomous: true

must_haves:
  truths:
    - "Help text clearly distinguishes CLI commands from slash commands"
    - "Help shows mapping between CLI and slash commands"
    - "Deprecated commands show warnings with migration path"
    - "All commands have descriptive help text"
    - "Examples section in help shows usage patterns"
  artifacts:
    - path: "bin/cli.js"
      provides: "Custom help with CLI/slash command mapping"
      contains: ["program.on('--help'", "Slash Commands", "CLI Commands"]
  key_links:
    - from: "bin/cli.js help output"
      to: ".claude/commands/ant/"
      via: "slash command documentation"
      pattern: "/ant:"
---

<objective>
Implement custom help text that distinguishes CLI commands from slash commands and add backward compatibility with deprecation warnings.

Purpose: Ensure users understand the difference between CLI commands (aether *) and Claude Code slash commands (/ant:*), and provide smooth migration path for any deprecated syntax.
Output: Enhanced help text with CLI/slash command sections and deprecation handling.
</objective>

<execution_context>
@~/.claude/cosmic-dev-system/workflows/execute-plan.md
@~/.claude/cosmic-dev-system/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-cli-improvements/04-CONTEXT.md
@.planning/phases/04-cli-improvements/04-RESEARCH.md

@/Users/callumcowie/repos/Aether/.planning/phases/04-cli-improvements/04-01-SUMMARY.md
@/Users/callumcowie/repos/Aether/.planning/phases/04-cli-improvements/04-02-SUMMARY.md

@/Users/callumcowie/repos/Aether/bin/cli.js
@/Users/callumcowie/repos/Aether/.claude/commands/ant/
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement custom help with CLI/slash command mapping</name>
  <files>bin/cli.js</files>
  <action>
    Add custom help output that clearly distinguishes CLI commands from slash commands.

    Per RESEARCH.md Pattern 2 and CONTEXT.md decisions:

    1. Add custom --help handler using program.on('--help'):
       program.on('--help', () => {
         console.log('');
         console.log(c.bold('Slash Commands (Claude Code):'));
         console.log('  /ant:init <goal>     Initialize colony in current repo');
         console.log('  /ant:status          Show colony status');
         console.log('  /ant:plan            Generate project plan');
         console.log('  /ant:build <n>       Build phase N');
         console.log('');
         console.log(c.dim('Run these in Claude Code after installing with "aether install"'));
       });

    2. Ensure the help clearly shows:
       - CLI Commands section (what aether * does)
       - Slash Commands section (what /ant:* does)
       - Clear explanation that slash commands require Claude Code

    3. Add examples section to main help:
       Examples:
         $ aether install                    # Install slash commands
         $ aether update --list              # Show registered repos
         $ aether update --all --force       # Force update all repos
         $ aether --no-color version         # Show version without colors

    4. Update individual command descriptions to be clear and helpful:
       - install: "Install slash-commands to ~/.claude/commands/ant/ and set up distribution hub"
       - update: "Update current repo from hub (use --all to update all registered repos)"
       - version: "Show installed version"
       - uninstall: "Remove slash-commands (preserves project state and hub)"

    5. Add .configureOutput() to customize error output if needed:
       program.configureOutput({
         outputError: (str, write) => write(c.error(str))
       });

    Reference existing .claude/commands/ant/ to know which slash commands exist.
  </action>
  <verify>
    Run: node bin/cli.js --help
    Verify output shows:
    - CLI Commands section
    - Slash Commands section with /ant:* commands
    - Examples section
    - Clear distinction between the two command types
  </verify>
  <done>
    Help output clearly distinguishes CLI commands from slash commands with mapping
  </done>
</task>

<task type="auto">
  <name>Task 2: Add backward compatibility and deprecation warnings</name>
  <files>bin/cli.js</files>
  <action>
    Add backward compatibility for any deprecated command syntax with warnings.

    Per RESEARCH.md Pattern 4 and CONTEXT.md decisions:

    1. Check for any deprecated patterns in current CLI:
       - Old flag names (e.g., --dryrun vs --dry-run)
       - Deprecated commands (e.g., aether init)

    2. Add deprecation handling for common patterns:
       - If --dryrun flag detected, warn and treat as --dry-run
       - If 'init' command used, show deprecation warning directing to /ant:init

    3. Implement deprecation helper:
       function showDeprecation(oldName, newName, isSlashCommand = false) {
         console.warn(c.warning(`Warning: "aether ${oldName}" is deprecated.`));
         if (isSlashCommand) {
           console.warn(c.warning(`  Use ${newName} in Claude Code instead.`));
         } else {
           console.warn(c.warning(`  Use "aether ${newName}" instead.`));
         }
       }

    4. Add deprecated 'init' command:
       program
         .command('init [goal]')
         .description('(deprecated) Use /ant:init instead')
         .action((goal) => {
           console.error(c.warning('Warning: "aether init" is deprecated.'));
           console.error(c.warning('  Use /ant:init in Claude Code instead:'));
           console.error(c.warning(`  /ant:init "${goal || 'your-goal-here'}"`));
           process.exit(1);
         });

    5. Handle deprecated flag aliases:
       - Add --dryrun as alias for --dry-run with warning
       - Use commander .option() with deprecation handler

    6. Ensure deprecation warnings:
       - Use c.warning() for yellow output
       - Clearly state what to use instead
       - Exit with error code for removed commands
       - Continue with warning for flag aliases

    Note: The current CLI doesn't have many deprecated patterns, but this establishes
    the pattern for future deprecations.
  </action>
  <verify>
    Run: node bin/cli.js init test-goal
    Verify deprecation warning appears and exits with error

    Run: node bin/cli.js update --dryrun (if implemented)
    Verify deprecation warning appears but command continues
  </verify>
  <done>
    Deprecated commands show clear warnings with migration paths, backward compatibility maintained
  </done>
</task>

</tasks>

<verification>
- [ ] Help output shows CLI Commands section
- [ ] Help output shows Slash Commands section
- [ ] Slash commands listed with /ant: prefix
- [ ] Examples section shows common usage patterns
- [ ] Deprecated 'init' command shows warning and exits
- [ ] All command descriptions are clear and helpful
- [ ] Color is used consistently in help output
- [ ] --no-color disables colors in help
</verification>

<success_criteria>
- Custom help distinguishes CLI vs slash commands
- All commands have descriptive help text
- Deprecation warnings guide users to correct syntax
- Examples show common usage patterns
- Help is visually organized with colors
</success_criteria>

<output>
After completion, create `.planning/phases/04-cli-improvements/04-03-SUMMARY.md`
</output>
